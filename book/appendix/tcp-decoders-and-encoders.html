
<!DOCTYPE HTML>
<html lang="" >
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>TCP Decoders and Encoders Â· GitBook</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.3">
        
        
        
    
    <link rel="stylesheet" href="../../gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-highlight/website.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-codetabs/codetabs.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-search/search.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
    
        
    
        
    
        
    
        
    
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../../gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="../../gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="../wallaroo-tools/giles-sender.html" />
    
    
    <link rel="prev" href="virtualenv.html" />
    

    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="Type to search" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        
    
        <li class="chapter " data-level="1.1" data-path="../../">
            
                <a href="../../">
            
                    
                    Introduction
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2" data-path="../what-is-wallaroo.html">
            
                <a href="../what-is-wallaroo.html">
            
                    
                    What is Wallaroo?
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">Core Concepts</li>
        
        
    
        <li class="chapter " data-level="2.1" data-path="../core-concepts/intro.html">
            
                <a href="../core-concepts/intro.html">
            
                    
                    Introduction
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.2" data-path="../core-concepts/core-concepts.html">
            
                <a href="../core-concepts/core-concepts.html">
            
                    
                    Introducing Wallaroo Core Concepts
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.3" data-path="../core-concepts/state.html">
            
                <a href="../core-concepts/state.html">
            
                    
                    State
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.4" data-path="../core-concepts/working-with-state.html">
            
                <a href="../core-concepts/working-with-state.html">
            
                    
                    Working with State
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.5" data-path="../core-concepts/partitioning.html">
            
                <a href="../core-concepts/partitioning.html">
            
                    
                    Partitioning
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">Wallaroo Language Support</li>
        
        
    
        <li class="chapter " data-level="3.1" data-path="../language_support.html">
            
                <a href="../language_support.html">
            
                    
                    Wallaroo Languages Supported
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">Wallaroo with Python</li>
        
        
    
        <li class="chapter " data-level="4.1" data-path="../python/intro.html">
            
                <a href="../python/intro.html">
            
                    
                    Wallaroo with Python Introduction
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.2" data-path="../getting-started/setting-up-your-environment.html">
            
                <a href="../getting-started/setting-up-your-environment.html">
            
                    
                    Setting up Your Environment
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="4.2.1" data-path="../getting-started/choosing-an-installation-option.html">
            
                <a href="../getting-started/choosing-an-installation-option.html">
            
                    
                    Choosing an Installation Option
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.2.2" data-path="../getting-started/installing-with-docker.html">
            
                <a href="../getting-started/installing-with-docker.html">
            
                    
                    Installing with Docker
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="4.2.2.1" data-path="../getting-started/docker-setup.html">
            
                <a href="../getting-started/docker-setup.html">
            
                    
                    Setting Up Your Environment
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.2.2.2" data-path="../getting-started/run-a-wallaroo-application-docker.html">
            
                <a href="../getting-started/run-a-wallaroo-application-docker.html">
            
                    
                    Run a Wallaroo Application in Docker
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="4.2.3" data-path="../getting-started/installing-with-vagrant.html">
            
                <a href="../getting-started/installing-with-vagrant.html">
            
                    
                    Installing with Vagrant
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="4.2.3.1" data-path="../getting-started/vagrant-setup.html">
            
                <a href="../getting-started/vagrant-setup.html">
            
                    
                    Setting Up Your Environment
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.2.3.2" data-path="../getting-started/run-a-wallaroo-application-vagrant.html">
            
                <a href="../getting-started/run-a-wallaroo-application-vagrant.html">
            
                    
                    Run a Wallaroo Application in Docker
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="4.2.4" data-path="../getting-started/installing-from-source.html">
            
                <a href="../getting-started/installing-from-source.html">
            
                    
                    Installing From Source
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="4.2.4.1" data-path="../getting-started/setup.html">
            
                <a href="../getting-started/setup.html">
            
                    
                    Setting up Your Environment
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="4.2.4.1.1" data-path="../getting-started/linux-setup.html">
            
                <a href="../getting-started/linux-setup.html">
            
                    
                    Ubuntu Installation
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="4.2.4.2" data-path="../getting-started/run-a-wallaroo-application.html">
            
                <a href="../getting-started/run-a-wallaroo-application.html">
            
                    
                    Run a Wallaroo Application
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="4.2.5" data-path="../getting-started/conclusion.html">
            
                <a href="../getting-started/conclusion.html">
            
                    
                    Conclusion
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="4.3" data-path="../python/wallaroo-python-api.html">
            
                <a href="../python/wallaroo-python-api.html">
            
                    
                    Wallaroo Python API
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="4.3.1" data-path="../python/running-a-wallaroo-python-application.html">
            
                <a href="../python/running-a-wallaroo-python-application.html">
            
                    
                    Running a Wallaroo Python Application
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.3.2" data-path="../python/writing-your-own-application.html">
            
                <a href="../python/writing-your-own-application.html">
            
                    
                    Writing Your Own Application
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.3.3" data-path="../python/writing-your-own-stateful-application.html">
            
                <a href="../python/writing-your-own-stateful-application.html">
            
                    
                    Writing Your Own Stateful Application
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.3.4" data-path="../python/writing-your-own-partitioned-stateful-application.html">
            
                <a href="../python/writing-your-own-partitioned-stateful-application.html">
            
                    
                    Writing Your Own Partitioned Stateful Application
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.3.5" data-path="../python/word-count.html">
            
                <a href="../python/word-count.html">
            
                    
                    Word Count
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.3.6" data-path="../python/interworker-serialization-and-resilience.html">
            
                <a href="../python/interworker-serialization-and-resilience.html">
            
                    
                    Interworker Serialization and Resilience
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.3.7" data-path="../python/api.html">
            
                <a href="../python/api.html">
            
                    
                    Wallaroo Python API
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="4.4" >
            
                <span>
            
                    
                    Debugging Python Wallaroo Applications
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="4.4.1" data-path="../python/debugging.html">
            
                <a href="../python/debugging.html">
            
                    
                    Debugging
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

    
        
        <li class="header">Wallaroo with Go</li>
        
        
    
        <li class="chapter " data-level="5.1" data-path="../go/intro.html">
            
                <a href="../go/intro.html">
            
                    
                    Go API Introduction
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.2" data-path="../go/getting-started/setting-up-your-environment.html">
            
                <a href="../go/getting-started/setting-up-your-environment.html">
            
                    
                    Setting up Your Environment
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="5.2.1" data-path="../go/getting-started/setup.html">
            
                <a href="../go/getting-started/setup.html">
            
                    
                    Setting up Your Environment
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="5.2.1.1" data-path="../go/getting-started/linux-setup.html">
            
                <a href="../go/getting-started/linux-setup.html">
            
                    
                    Ubuntu Installation
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="5.2.2" data-path="../go/getting-started/run-a-wallaroo-go-application.html">
            
                <a href="../go/getting-started/run-a-wallaroo-go-application.html">
            
                    
                    Run a Wallaroo Go Application
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.2.3" data-path="../go/getting-started/conclusion.html">
            
                <a href="../go/getting-started/conclusion.html">
            
                    
                    Conclusion
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="5.3" data-path="../go/api/wallaroo-go-api.html">
            
                <a href="../go/api/wallaroo-go-api.html">
            
                    
                    Wallaroo Go API
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="5.3.1" data-path="../go/api/writing-your-own-application.html">
            
                <a href="../go/api/writing-your-own-application.html">
            
                    
                    Writing Your Own Application
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.3.2" data-path="../go/api/writing-your-own-stateful-application.html">
            
                <a href="../go/api/writing-your-own-stateful-application.html">
            
                    
                    Writing Your Own Stateful Application
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.3.3" data-path="../go/api/word-count.html">
            
                <a href="../go/api/word-count.html">
            
                    
                    Word Count
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.3.4" data-path="../go/api/interworker-serialization-and-resilience.html">
            
                <a href="../go/api/interworker-serialization-and-resilience.html">
            
                    
                    Interworker Serialization and Resilience
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.3.5" data-path="../go/api/start-a-project.html">
            
                <a href="../go/api/start-a-project.html">
            
                    
                    Start A Go Project
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.3.6" data-path="../go/api/api.html">
            
                <a href="../go/api/api.html">
            
                    
                    Wallaroo Go API
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

    
        
        <li class="header">Running Wallaroo</li>
        
        
    
        <li class="chapter " data-level="6.1" data-path="../running-wallaroo/running-wallaroo.html">
            
                <a href="../running-wallaroo/running-wallaroo.html">
            
                    
                    Running Wallaroo
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="6.2" data-path="../running-wallaroo/autoscale.html">
            
                <a href="../running-wallaroo/autoscale.html">
            
                    
                    Autoscale
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="6.3" data-path="../running-wallaroo/wallaroo-command-line-options.html">
            
                <a href="../running-wallaroo/wallaroo-command-line-options.html">
            
                    
                    Command line options
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">Appendix</li>
        
        
    
        <li class="chapter " data-level="7.1" data-path="virtualenv.html">
            
                <a href="virtualenv.html">
            
                    
                    Wallaroo and Virtualenv
            
                </a>
            

            
        </li>
    
        <li class="chapter active" data-level="7.2" data-path="tcp-decoders-and-encoders.html">
            
                <a href="tcp-decoders-and-encoders.html">
            
                    
                    TCP Decoders and Encoders
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="7.3" data-path="../wallaroo-tools/giles-sender.html">
            
                <a href="../wallaroo-tools/giles-sender.html">
            
                    
                    Sending Data over TCP with Giles Sender
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="7.4" data-path="../wallaroo-tools/giles-receiver.html">
            
                <a href="../wallaroo-tools/giles-receiver.html">
            
                    
                    Receiving Data over TCP with Giles Receiver
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="7.5" data-path="../metrics/metrics-ui.html">
            
                <a href="../metrics/metrics-ui.html">
            
                    
                    Monitoring Metrics with the Monitoring Hub
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="7.6" data-path="decoding-giles-receiver-output.html">
            
                <a href="decoding-giles-receiver-output.html">
            
                    
                    Decoding Giles Receiver Output
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="7.7" data-path="wallaroo-and-long-running-data-processing-and-other-workflows.html">
            
                <a href="wallaroo-and-long-running-data-processing-and-other-workflows.html">
            
                    
                    Wallaroo and Long-Running Data Processing and Other Workflows
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="7.8" data-path="wallaroo-in-docker-tips.html">
            
                <a href="wallaroo-in-docker-tips.html">
            
                    
                    Tips for using Wallaroo in Docker
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">Legal</li>
        
        
    
        <li class="chapter " data-level="8.1" data-path="../legal/terms.html">
            
                <a href="../legal/terms.html">
            
                    
                    Terms and Conditions
            
                </a>
            

            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            Published with GitBook
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href="../.." >TCP Decoders and Encoders</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <h1 id="tcp-decoders-and-encoders">TCP Decoders and Encoders</h1>
<p>Earlier, we spoke of <a href="../../core-concepts/core-concepts.md">sources and sinks</a> and the role they play in Wallaroo. In this section, we are going to dive more into how you work with sources and sinks. We&apos;ll be covering two key concepts: <code>Decoder</code>s and <code>Encoder</code>s. </p>
<h2 id="reviewing-our-terms">Reviewing our terms</h2>
<h3 id="source">Source</h3>
<p>Input point for data from external systems into an application.</p>
<h3 id="sink">Sink</h3>
<p>Output point from an application to external systems.</p>
<h3 id="decoder">Decoder</h3>
<p>Code that transforms a stream of bytes from an external system
into a series of application input types.</p>
<h3 id="encoder">Encoder</h3>
<p>Code that transforms an application output type into bytes for
sending to an external system.</p>
<h2 id="framed-message-protocols">Framed Message Protocols</h2>
<p>A Wallaroo TCP Source accepts a stream of bytes from an external source and turns that stream of bytes into a stream of application specific messages. As an application programmer, you provide a <code>Decoder</code> to tell Wallaroo how to turn that stream of bytes into messages.</p>
<p>An incoming stream of bytes can represent many things: each byte could be an 8-bit unsigned integer, or every 4-byte block may be a 32-bit integer. Or the stream may be an ASCII sequence (each byte is a char), or a Unicode sequence (in which case characters aren&apos;t equally-wide!).</p>
<p>Decoders are unique to the type of source. <code>TCPSource</code>s use a <a href="https://www.codeproject.com/Articles/37496/TCP-IP-Protocol-Design-Message-Framing" target="_blank">framed message protocol</a>. A framed message protocol boils down to:</p>
<ul>
<li>We have a fixed size header that tells us how long a message is</li>
<li>We have a variable length message payload </li>
</ul>
<p>The message payload is what our application cares about. The fixed length header allows us to easily get the size of our payload. With these two pieces of information, we can quickly chop up a stream of incoming bytes into a series of messages.</p>
<p>The size of the header is up to you the designer of the particular message type. You can make it 4 bytes, 8 bytes, 16, et cetera. The important part is that you need enough bytes to represent the length of your payload. For most data, a 4-byte header is plenty. In the abstract, this looks like</p>
<pre><code>PayloadSize [x bytes] : Payload [bytes specified in PayloadSize]
</code></pre><p>So if our header is 4 bytes long, an incoming message would look something like:</p>
<table>
<thead>
<tr>
<th>header</th>
<th>payload</th>
</tr>
</thead>
<tbody>
<tr>
<td>xxxx</td>
<td>some data here</td>
</tr>
</tbody>
</table>
<p>Let&apos;s make that a bit more concrete. Let&apos;s say we are sending in two messages; each contains a string. The first has &quot;first&quot; as a payload and the second payload is &quot;not first&quot;. Our stream of bytes would be:</p>
<ul>
<li>4-byte header whose value is <code>5</code></li>
<li>5-byte payload containing the binary representation of the ASCII string &quot;first&quot;</li>
<li>4-byte header whose value is <code>9</code></li>
<li>9 byte payload containing the binary representation of the ASCII string &quot;not first&quot;</li>
</ul>
<h2 id="creating-a-decoder">Creating a Decoder</h2>
<p>Wallaroo&apos;s <code>TCPSource</code> takes a decoder <em>function</em> that can process a framed message protocol. You&apos;ll need to implement three methods. Below is a decoder that we can use to process our stream of strings that we layed out in the previous section.</p>
<pre><code class="lang-python"><span class="hljs-meta">@wallaroo.decoder(header_length=4, length_fmt=&quot;&gt;I&quot;)</span>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">decode</span><span class="hljs-params">(self, bs)</span>:</span>
    <span class="hljs-keyword">return</span> bs.decode(<span class="hljs-string">&quot;utf-8&quot;</span>)
</code></pre>
<p><code>header_length</code> is the fixed size of our payload field. </p>
<p><code>length_fmt</code> is used internally to decode our message header to determine how long the payload is going to be. We rely on the Python <code>struct</code> package to decode the bytes. If you aren&apos;t familiar with <code>struct</code>, you can check out <a href="https://docs.python.org/2/library/struct.html" target="_blank">the documentation</a> to learn more. Remember, when using <code>struct</code>, don&apos;t forget to import it!</p>
<p><code>decode</code> takes a series of bytes that represent your payload and turns it into an application message. In this case, our application message is a string, so we take the incoming byte stream <code>bs</code> and convert it to UTF-8 Python string.</p>
<p>Here&apos;s a slightly more complicated example taken from our <a href="https://github.com/WallarooLabs/wallaroo/tree/release-0.5.0/examples/python/alphabet" target="_blank">Alphabet Popularity Contest example</a>. </p>
<pre><code class="lang-python"><span class="hljs-meta">@wallaroo.decoder(header_length=4, length_fmt=&quot;&gt;I&quot;)</span>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">decode</span><span class="hljs-params">(self, bs)</span>:</span>
    (letter, vote_count) = struct.unpack(<span class="hljs-string">&quot;&gt;sI&quot;</span>, bs)
    <span class="hljs-keyword">return</span> Votes(letter, vote_count)
</code></pre>
<p>Like we did in our previous example, we&apos;re using a 4-byte integer payload length header:</p>
<pre><code class="lang-python"><span class="hljs-meta">@wallaroo.decoder(header_length=4, length_fmt=&quot;&gt;I&quot;)</span>
</code></pre>
<p>But this time, we are doing something slightly more complicated in our payload. Our payload is two items, a string representing a letter and some votes for that letter. We&apos;ll unpack those using <code>struct</code> and create a domain specific object <code>Votes</code> to return.</p>
<pre><code class="lang-python"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">decode</span><span class="hljs-params">(self, bs)</span>:</span>
    (letter, vote_count) = struct.unpack(<span class="hljs-string">&quot;&gt;sI&quot;</span>, bs)
    <span class="hljs-keyword">return</span> Votes(letter, vote_count)
</code></pre>
<h2 id="creating-an-encoder">Creating an Encoder</h2>
<p>Wallaroo encoders do the opposite of decoders. A decoder takes a stream of bytes and turns in into messages for Wallaroo to process. An encoder receives a stream of messages and converts them into a stream of bytes for sending to another system.</p>
<p>Here&apos;s a quick example encoder:</p>
<pre><code class="lang-python"><span class="hljs-meta">@wallaroo.encoder</span>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">encode</span><span class="hljs-params">(self, data)</span>:</span>
    <span class="hljs-comment"># data is a string</span>
    <span class="hljs-keyword">return</span> data + <span class="hljs-string">&quot;\n&quot;</span>
</code></pre>
<p>This is just about the simplest encoder you could have. It&apos;s from the <a href="https://github.com/WallarooLabs/wallaroo/tree/release-0.5.0/examples/python/reverse" target="_blank">Reverse Word example</a>. It takes a string that we want to send to an external system as an input, adds a newline at the end and returns it for sending. </p>
<p>Here&apos;s a more complicated example taken from our <a href="https://github.com/WallarooLabs/wallaroo/tree/release-0.5.0/examples/python/alphabet" target="_blank">Alphabet Popularity Contest example</a>:</p>
<pre><code class="lang-python"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Votes</span><span class="hljs-params">(object)</span>:</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span><span class="hljs-params">(self, letter, votes)</span>:</span>
        self.letter = letter
        self.votes = votes

<span class="hljs-meta">@wallaroo.encoder</span>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">encode</span><span class="hljs-params">(self, data)</span>:</span>
    <span class="hljs-comment"># data is a Votes</span>
    <span class="hljs-keyword">return</span> struct.pack(<span class="hljs-string">&quot;&gt;IsQ&quot;</span>, <span class="hljs-number">9</span>, data.letter, data.votes)
</code></pre>
<p>Let&apos;s take a look at what is happening here. First of all, we are once again using the Python <code>struct</code> package. In this case, though, we are creating our own packed binary message. It&apos;s a framed message with a 4-byte header for the payload length, plus the payload:</p>
<p>| header | payload |
| 9 | letter &amp; votes |</p>
<p>If we were encoding the letter &quot;A&quot; and a vote value of &quot;1&quot; our payload would be <code>&apos;A\x00\x00\x00\x00\x00\x00\x00\x01&apos;</code>. This along with our framing data can be sent along to another system that expects framed data.</p>

                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="virtualenv.html" class="navigation navigation-prev " aria-label="Previous page: Wallaroo and Virtualenv">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
                <a href="../wallaroo-tools/giles-sender.html" class="navigation navigation-next " aria-label="Next page: Sending Data over TCP with Giles Sender">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"TCP Decoders and Encoders","level":"7.2","depth":1,"next":{"title":"Sending Data over TCP with Giles Sender","level":"7.3","depth":1,"path":"book/wallaroo-tools/giles-sender.md","ref":"book/wallaroo-tools/giles-sender.md","articles":[]},"previous":{"title":"Wallaroo and Virtualenv","level":"7.1","depth":1,"path":"book/appendix/virtualenv.md","ref":"book/appendix/virtualenv.md","articles":[]},"dir":"ltr"},"config":{"gitbook":"*","theme":"default","variables":{},"plugins":["highlight","footnote-string-to-number","ga","codetabs"],"pluginsConfig":{"search":{},"codetabs":{},"footnote-string-to-number":{},"lunr":{"maxIndexSize":1000000,"ignoreSpecialCharacters":false},"fontsettings":{"theme":"white","family":"sans","size":2},"highlight":{},"ga":{"configuration":"auto","token":"UA-59652249-3"},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false}},"structure":{"langs":"LANGS.md","readme":"intro.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56},"footerTemplate":"Â©2017 All Rights Reserved, Wallaroo Labs"},"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"}},"file":{"path":"book/appendix/tcp-decoders-and-encoders.md","mtime":"2018-07-17T16:13:35.246Z","type":"markdown"},"gitbook":{"version":"3.2.3","time":"2018-07-17T16:13:39.498Z"},"basePath":"../..","book":{"language":""}});
        });
    </script>
</div>

        
    <script src="../../gitbook/gitbook.js"></script>
    <script src="../../gitbook/theme.js"></script>
    
        
        <script src="../../gitbook/gitbook-plugin-ga/plugin.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-codetabs/codetabs.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-search/search-engine.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-search/search.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-lunr/lunr.min.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-lunr/search-lunr.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-sharing/buttons.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

    </body>
</html>

