
<!DOCTYPE HTML>
<html lang="" >
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>Word Count · GitBook</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.3">
        
        
        
    
    <link rel="stylesheet" href="../../../gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="../../../gitbook/gitbook-plugin-highlight/website.css">
                
            
                
                <link rel="stylesheet" href="../../../gitbook/gitbook-plugin-codetabs/codetabs.css">
                
            
                
                <link rel="stylesheet" href="../../../gitbook/gitbook-plugin-search/search.css">
                
            
                
                <link rel="stylesheet" href="../../../gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
    
        
    
        
    
        
    
        
    
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../../../gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="../../../gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="interworker-serialization-and-resilience.html" />
    
    
    <link rel="prev" href="writing-your-own-stateful-application.html" />
    

    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="Type to search" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        
    
        <li class="chapter " data-level="1.1" data-path="../../../">
            
                <a href="../../../">
            
                    
                    Introduction
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2" data-path="../../what-is-wallaroo.html">
            
                <a href="../../what-is-wallaroo.html">
            
                    
                    What is Wallaroo?
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">Core Concepts</li>
        
        
    
        <li class="chapter " data-level="2.1" data-path="../../core-concepts/intro.html">
            
                <a href="../../core-concepts/intro.html">
            
                    
                    Introduction
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.2" data-path="../../core-concepts/core-concepts.html">
            
                <a href="../../core-concepts/core-concepts.html">
            
                    
                    Introducing Wallaroo Core Concepts
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.3" data-path="../../core-concepts/state.html">
            
                <a href="../../core-concepts/state.html">
            
                    
                    State
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.4" data-path="../../core-concepts/working-with-state.html">
            
                <a href="../../core-concepts/working-with-state.html">
            
                    
                    Working with State
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.5" data-path="../../core-concepts/partitioning.html">
            
                <a href="../../core-concepts/partitioning.html">
            
                    
                    Partitioning
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">Wallaroo Language Support</li>
        
        
    
        <li class="chapter " data-level="3.1" data-path="../../language_support.html">
            
                <a href="../../language_support.html">
            
                    
                    Wallaroo Languages Supported
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">Wallaroo with Python</li>
        
        
    
        <li class="chapter " data-level="4.1" data-path="../../python/intro.html">
            
                <a href="../../python/intro.html">
            
                    
                    Wallaroo with Python Introduction
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.2" data-path="../../getting-started/setting-up-your-environment.html">
            
                <a href="../../getting-started/setting-up-your-environment.html">
            
                    
                    Setting up Your Environment
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="4.2.1" data-path="../../getting-started/choosing-an-installation-option.html">
            
                <a href="../../getting-started/choosing-an-installation-option.html">
            
                    
                    Choosing an Installation Option
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.2.2" data-path="../../getting-started/installing-with-docker.html">
            
                <a href="../../getting-started/installing-with-docker.html">
            
                    
                    Installing with Docker
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="4.2.2.1" data-path="../../getting-started/docker-setup.html">
            
                <a href="../../getting-started/docker-setup.html">
            
                    
                    Setting Up Your Environment
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.2.2.2" data-path="../../getting-started/run-a-wallaroo-application-docker.html">
            
                <a href="../../getting-started/run-a-wallaroo-application-docker.html">
            
                    
                    Run a Wallaroo Application in Docker
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="4.2.3" data-path="../../getting-started/installing-with-vagrant.html">
            
                <a href="../../getting-started/installing-with-vagrant.html">
            
                    
                    Installing with Vagrant
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="4.2.3.1" data-path="../../getting-started/vagrant-setup.html">
            
                <a href="../../getting-started/vagrant-setup.html">
            
                    
                    Setting Up Your Environment
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.2.3.2" data-path="../../getting-started/run-a-wallaroo-application-vagrant.html">
            
                <a href="../../getting-started/run-a-wallaroo-application-vagrant.html">
            
                    
                    Run a Wallaroo Application in Docker
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="4.2.4" data-path="../../getting-started/installing-from-source.html">
            
                <a href="../../getting-started/installing-from-source.html">
            
                    
                    Installing From Source
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="4.2.4.1" data-path="../../getting-started/setup.html">
            
                <a href="../../getting-started/setup.html">
            
                    
                    Setting up Your Environment
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="4.2.4.1.1" data-path="../../getting-started/linux-setup.html">
            
                <a href="../../getting-started/linux-setup.html">
            
                    
                    Ubuntu Installation
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="4.2.4.2" data-path="../../getting-started/run-a-wallaroo-application.html">
            
                <a href="../../getting-started/run-a-wallaroo-application.html">
            
                    
                    Run a Wallaroo Application
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="4.2.5" data-path="../../getting-started/conclusion.html">
            
                <a href="../../getting-started/conclusion.html">
            
                    
                    Conclusion
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="4.3" data-path="../../python/wallaroo-python-api.html">
            
                <a href="../../python/wallaroo-python-api.html">
            
                    
                    Wallaroo Python API
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="4.3.1" data-path="../../python/running-a-wallaroo-python-application.html">
            
                <a href="../../python/running-a-wallaroo-python-application.html">
            
                    
                    Running a Wallaroo Python Application
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.3.2" data-path="../../python/writing-your-own-application.html">
            
                <a href="../../python/writing-your-own-application.html">
            
                    
                    Writing Your Own Application
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.3.3" data-path="../../python/writing-your-own-stateful-application.html">
            
                <a href="../../python/writing-your-own-stateful-application.html">
            
                    
                    Writing Your Own Stateful Application
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.3.4" data-path="../../python/writing-your-own-partitioned-stateful-application.html">
            
                <a href="../../python/writing-your-own-partitioned-stateful-application.html">
            
                    
                    Writing Your Own Partitioned Stateful Application
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.3.5" data-path="../../python/word-count.html">
            
                <a href="../../python/word-count.html">
            
                    
                    Word Count
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.3.6" data-path="../../python/interworker-serialization-and-resilience.html">
            
                <a href="../../python/interworker-serialization-and-resilience.html">
            
                    
                    Interworker Serialization and Resilience
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.3.7" data-path="../../python/api.html">
            
                <a href="../../python/api.html">
            
                    
                    Wallaroo Python API
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="4.4" >
            
                <span>
            
                    
                    Debugging Python Wallaroo Applications
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="4.4.1" data-path="../../python/debugging.html">
            
                <a href="../../python/debugging.html">
            
                    
                    Debugging
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

    
        
        <li class="header">Wallaroo with Go</li>
        
        
    
        <li class="chapter " data-level="5.1" data-path="../intro.html">
            
                <a href="../intro.html">
            
                    
                    Go API Introduction
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.2" data-path="../getting-started/setting-up-your-environment.html">
            
                <a href="../getting-started/setting-up-your-environment.html">
            
                    
                    Setting up Your Environment
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="5.2.1" data-path="../getting-started/setup.html">
            
                <a href="../getting-started/setup.html">
            
                    
                    Setting up Your Environment
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="5.2.1.1" data-path="../getting-started/linux-setup.html">
            
                <a href="../getting-started/linux-setup.html">
            
                    
                    Ubuntu Installation
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="5.2.2" data-path="../getting-started/run-a-wallaroo-go-application.html">
            
                <a href="../getting-started/run-a-wallaroo-go-application.html">
            
                    
                    Run a Wallaroo Go Application
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.2.3" data-path="../getting-started/conclusion.html">
            
                <a href="../getting-started/conclusion.html">
            
                    
                    Conclusion
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="5.3" data-path="wallaroo-go-api.html">
            
                <a href="wallaroo-go-api.html">
            
                    
                    Wallaroo Go API
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="5.3.1" data-path="writing-your-own-application.html">
            
                <a href="writing-your-own-application.html">
            
                    
                    Writing Your Own Application
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.3.2" data-path="writing-your-own-stateful-application.html">
            
                <a href="writing-your-own-stateful-application.html">
            
                    
                    Writing Your Own Stateful Application
            
                </a>
            

            
        </li>
    
        <li class="chapter active" data-level="5.3.3" data-path="word-count.html">
            
                <a href="word-count.html">
            
                    
                    Word Count
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.3.4" data-path="interworker-serialization-and-resilience.html">
            
                <a href="interworker-serialization-and-resilience.html">
            
                    
                    Interworker Serialization and Resilience
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.3.5" data-path="start-a-project.html">
            
                <a href="start-a-project.html">
            
                    
                    Start A Go Project
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.3.6" data-path="api.html">
            
                <a href="api.html">
            
                    
                    Wallaroo Go API
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

    
        
        <li class="header">Running Wallaroo</li>
        
        
    
        <li class="chapter " data-level="6.1" data-path="../../running-wallaroo/running-wallaroo.html">
            
                <a href="../../running-wallaroo/running-wallaroo.html">
            
                    
                    Running Wallaroo
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="6.2" data-path="../../running-wallaroo/autoscale.html">
            
                <a href="../../running-wallaroo/autoscale.html">
            
                    
                    Autoscale
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="6.3" data-path="../../running-wallaroo/wallaroo-command-line-options.html">
            
                <a href="../../running-wallaroo/wallaroo-command-line-options.html">
            
                    
                    Command line options
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">Appendix</li>
        
        
    
        <li class="chapter " data-level="7.1" data-path="../../appendix/virtualenv.html">
            
                <a href="../../appendix/virtualenv.html">
            
                    
                    Wallaroo and Virtualenv
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="7.2" data-path="../../appendix/tcp-decoders-and-encoders.html">
            
                <a href="../../appendix/tcp-decoders-and-encoders.html">
            
                    
                    TCP Decoders and Encoders
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="7.3" data-path="../../wallaroo-tools/giles-sender.html">
            
                <a href="../../wallaroo-tools/giles-sender.html">
            
                    
                    Sending Data over TCP with Giles Sender
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="7.4" data-path="../../wallaroo-tools/giles-receiver.html">
            
                <a href="../../wallaroo-tools/giles-receiver.html">
            
                    
                    Receiving Data over TCP with Giles Receiver
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="7.5" data-path="../../metrics/metrics-ui.html">
            
                <a href="../../metrics/metrics-ui.html">
            
                    
                    Monitoring Metrics with the Monitoring Hub
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="7.6" data-path="../../appendix/decoding-giles-receiver-output.html">
            
                <a href="../../appendix/decoding-giles-receiver-output.html">
            
                    
                    Decoding Giles Receiver Output
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="7.7" data-path="../../appendix/wallaroo-and-long-running-data-processing-and-other-workflows.html">
            
                <a href="../../appendix/wallaroo-and-long-running-data-processing-and-other-workflows.html">
            
                    
                    Wallaroo and Long-Running Data Processing and Other Workflows
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="7.8" data-path="../../appendix/wallaroo-in-docker-tips.html">
            
                <a href="../../appendix/wallaroo-in-docker-tips.html">
            
                    
                    Tips for using Wallaroo in Docker
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">Legal</li>
        
        
    
        <li class="chapter " data-level="8.1" data-path="../../legal/terms.html">
            
                <a href="../../legal/terms.html">
            
                    
                    Terms and Conditions
            
                </a>
            

            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            Published with GitBook
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href="../../.." >Word Count</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <h1 id="bringing-it-all-together-with-word-count">Bringing it all together with word count</h1>
<p>Word count is the canonical streaming data application. It&apos;s canonical not because everyone needs to count words but because it&apos;s a good platform for demonstrating how to do many of the everyday tasks in a streaming application.</p>
<p>This section will take you through our <a href="https://github.com/WallarooLabs/wallaroo/tree/release-0.4.4/examples/go/word_count/" target="_blank">Wallaroo word count example</a>. Along the way, we will introduce you to a couple of new concepts: parallelizing stateless computations, and splitting one incoming message into several outgoing ones.</p>
<h2 id="word-count">Word count</h2>
<p>Our word counting application receives text input in the form of chunks of text. It then splits those chunks into lines and from there into individual words. We then send those words to a stateful partition where we increment the running count and finally, after updating, send as output the word and its current count.</p>
<h3 id="application-setup">Application Setup</h3>
<p>Let&apos;s dive in and take a look at our application setup:</p>
<pre><code class="lang-go"><span class="hljs-comment">//export ApplicationSetup</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">ApplicationSetup</span><span class="hljs-params">()</span> *<span class="hljs-title">C</span>.<span class="hljs-title">char</span></span> {
    fs := flag.NewFlagSet(<span class="hljs-string">&quot;wallaroo&quot;</span>, flag.ExitOnError)
    inHostsPortsArg := fs.String(<span class="hljs-string">&quot;in&quot;</span>, <span class="hljs-string">&quot;&quot;</span>, <span class="hljs-string">&quot;input host:port list&quot;</span>)
    outHostsPortsArg := fs.String(<span class="hljs-string">&quot;out&quot;</span>, <span class="hljs-string">&quot;&quot;</span>, <span class="hljs-string">&quot;output host:port list&quot;</span>)

    fs.Parse(wa.Args[<span class="hljs-number">1</span>:])

    inHostsPorts := hostsPortsToList(*inHostsPortsArg)

    inHost := inHostsPorts[<span class="hljs-number">0</span>][<span class="hljs-number">0</span>]
    inPort := inHostsPorts[<span class="hljs-number">0</span>][<span class="hljs-number">1</span>]

    outHostsPorts := hostsPortsToList(*outHostsPortsArg)
    outHost := outHostsPorts[<span class="hljs-number">0</span>][<span class="hljs-number">0</span>]
    outPort := outHostsPorts[<span class="hljs-number">0</span>][<span class="hljs-number">1</span>]

    wa.Serialize = Serialize
    wa.Deserialize = Deserialize

    application := app.MakeApplication(<span class="hljs-string">&quot;Word Count Application&quot;</span>)
    application.NewPipeline(<span class="hljs-string">&quot;Split and Count&quot;</span>, app.MakeTCPSourceConfig(inHost, inPort, &amp;Decoder{})).
        ToMulti(&amp;SplitBuilder{}).
        ToStatePartition(&amp;CountWord{}, &amp;WordTotalsBuilder{}, <span class="hljs-string">&quot;word totals&quot;</span>, &amp;WordPartitionFunction{}, LetterPartition()).
        ToSink(app.MakeTCPSinkConfig(outHost, outPort, &amp;Encoder{}))

    json := application.ToJson()

    <span class="hljs-keyword">return</span> C.CString(json)
}
</code></pre>
<p>By now, hopefully, most of this looks somewhat familiar. We&apos;re building on concepts we&apos;ve seen in our previous example applications. We get the input and output information from the command line:</p>
<pre><code class="lang-go">    fs := flag.NewFlagSet(<span class="hljs-string">&quot;wallaroo&quot;</span>, flag.ExitOnError)
    inHostsPortsArg := fs.String(<span class="hljs-string">&quot;in&quot;</span>, <span class="hljs-string">&quot;&quot;</span>, <span class="hljs-string">&quot;input host:port list&quot;</span>)
    outHostsPortsArg := fs.String(<span class="hljs-string">&quot;out&quot;</span>, <span class="hljs-string">&quot;&quot;</span>, <span class="hljs-string">&quot;output host:port list&quot;</span>)

    fs.Parse(wa.Args[<span class="hljs-number">1</span>:])

    inHostsPorts := hostsPortsToList(*inHostsPortsArg)

    inHost := inHostsPorts[<span class="hljs-number">0</span>][<span class="hljs-number">0</span>]
    inPort := inHostsPorts[<span class="hljs-number">0</span>][<span class="hljs-number">1</span>]
</code></pre>
<p>We point the Wallaroo serialization and deserialization functions to our serializer and deserializer:</p>
<pre><code class="lang-go">    wa.Serialize = Serialize
    wa.Deserialize = Deserialize
</code></pre>
<p>We set up a new application with a single pipeline:</p>
<pre><code class="lang-go">    application := app.MakeApplication(<span class="hljs-string">&quot;Word Count Application&quot;</span>)
    application.NewPipeline(<span class="hljs-string">&quot;Split and Count&quot;</span>, app.MakeTCPSourceConfig(inHost, inPort, &amp;Decoder{})).
        ToMulti(&amp;SplitBuilder{}).
        ToStatePartition(&amp;CountWord{}, &amp;WordTotalsBuilder{}, <span class="hljs-string">&quot;word totals&quot;</span>, &amp;WordPartitionFunction{}, LetterPartition()).
        ToSink(app.MakeTCPSinkConfig(outHost, outPort, &amp;Encoder{}))
</code></pre>
<p>Upon receiving some textual input, our word count application will route it to a stateless computation called <code>Split</code>. <code>Split</code> is responsible for breaking the text down into individual words:</p>
<pre><code class="lang-go">        ToMulti(&amp;SplitBuilder{}).
</code></pre>
<p>After we split our text chunks into words, they get routed to a state partition where they are counted:</p>
<pre><code class="lang-go">        ToStatePartition(&amp;CountWord{}, &amp;WordTotalsBuilder{}, <span class="hljs-string">&quot;word totals&quot;</span>, &amp;WordPartitionFunction{}, LetterPartition()).
</code></pre>
<p>Note we set up 27 partitions to count our words, one for each letter plus one called &quot;!&quot; which will handle any &quot;word&quot; that doesn&apos;t start with a letter:</p>
<pre><code class="lang-go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">LetterPartition</span><span class="hljs-params">()</span> []<span class="hljs-title">uint64</span></span> {
    letterPartition := <span class="hljs-built_in">make</span>([]<span class="hljs-keyword">uint64</span>, <span class="hljs-number">27</span>)

    <span class="hljs-keyword">for</span> i := <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">26</span>; i++ {
        letterPartition[i] = <span class="hljs-keyword">uint64</span>(i + <span class="hljs-string">&apos;a&apos;</span>)
    }

    letterPartition[<span class="hljs-number">26</span>] = <span class="hljs-string">&apos;!&apos;</span>

    <span class="hljs-keyword">return</span> letterPartition
}
</code></pre>
<h2 id="splitting-words">Splitting Words</h2>
<p>Our word splitting is mostly uninteresting, except for one huge difference: our previous examples had one output for each input. When splitting text into words, we take one input and produce multiple outputs. Let&apos;s see how that is done.</p>
<pre><code class="lang-go"><span class="hljs-keyword">type</span> Split <span class="hljs-keyword">struct</span> {}

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(s *Split)</span> <span class="hljs-title">Name</span><span class="hljs-params">()</span> <span class="hljs-title">string</span></span> {
    <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;split&quot;</span>
}

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(s *Split)</span> <span class="hljs-title">Compute</span><span class="hljs-params">(data <span class="hljs-keyword">interface</span>{})</span> []<span class="hljs-title">interface</span></span>{} {
    punctuation := <span class="hljs-string">&quot; !\&quot;#$%&amp;&apos;()*+,-./:;&lt;=&gt;?@[\\]^_`{|}~&quot;</span>
    lines := data.(*<span class="hljs-keyword">string</span>)

    words := <span class="hljs-built_in">make</span>([]<span class="hljs-keyword">interface</span>{}, <span class="hljs-number">0</span>)

    <span class="hljs-keyword">for</span> _, line := <span class="hljs-keyword">range</span> strings.Split(*lines, <span class="hljs-string">&quot;\n&quot;</span>) {
        clean_line := strings.Trim(strings.ToLower(line), punctuation)
        <span class="hljs-keyword">for</span> _, word := <span class="hljs-keyword">range</span> strings.Split(clean_line, <span class="hljs-string">&quot; &quot;</span>) {
            clean_word := strings.Trim(word, punctuation)
            words = <span class="hljs-built_in">append</span>(words, &amp;clean_word)
        }
    }

    <span class="hljs-keyword">return</span> words
}
</code></pre>
<p>Did you catch what is going on? Previously, we&apos;ve seen our stateless computations have a <code>Compute</code> method that returns an <code>interface{}</code>. <code>Split</code> returns a <code>[]interface{}</code>. Each item in the slice is a new message that is sent individually to the next step in the pipeline. This allows us to then route each message based on its first letter for counting. If you look below, you can see that our word partitioning function is expecting words, not a list, which makes sense:</p>
<pre><code class="lang-go"><span class="hljs-keyword">type</span> WordPartitionFunction <span class="hljs-keyword">struct</span> {}

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(wpf *WordPartitionFunction)</span> <span class="hljs-title">Partition</span> <span class="hljs-params">(data <span class="hljs-keyword">interface</span>{})</span> <span class="hljs-title">uint64</span></span> {
    word := data.(*<span class="hljs-keyword">string</span>)
    firstLetter := (*word)[<span class="hljs-number">0</span>]
    <span class="hljs-keyword">if</span> (firstLetter &gt;= <span class="hljs-string">&apos;a&apos;</span>) &amp;&amp; (firstLetter &lt;= <span class="hljs-string">&apos;z&apos;</span>) {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">uint64</span>(firstLetter)
    }
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">uint64</span>(<span class="hljs-string">&apos;!&apos;</span>)
}
</code></pre>
<h3 id="our-counting-guts">Our Counting Guts</h3>
<p>The next three classes are the core of our word counting application. By this point, our messages have been split into individual words and run through our <code>WordPartitionFunction</code> and will arrive at a state computation based on the first letter of the word.</p>
<p>Let&apos;s take a look at what we have. <code>CountWord</code> is a <code>StateComputation</code>. When it&apos;s run, we update our state to reflect the new incoming word. Then, it returns the return value from <code>wordTotals.GetCount</code> and <code>true</code>. The return value of <code>GetCount</code> is an instance of the <code>WordCount</code> class containing the word and its current count.</p>
<pre><code class="lang-go"><span class="hljs-keyword">type</span> CountWord <span class="hljs-keyword">struct</span> {}

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(cw *CountWord)</span> <span class="hljs-title">Name</span><span class="hljs-params">()</span> <span class="hljs-title">string</span></span> {
    <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;count word&quot;</span>
}

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(cw *CountWord)</span> <span class="hljs-title">Compute</span><span class="hljs-params">(data <span class="hljs-keyword">interface</span>{}, state <span class="hljs-keyword">interface</span>{})</span> <span class="hljs-params">(<span class="hljs-keyword">interface</span>{}, <span class="hljs-keyword">bool</span>)</span></span> {
    word := data.(*<span class="hljs-keyword">string</span>)
    wordTotals := state.(*WordTotals)
    wordTotals.Update(*word)
    <span class="hljs-keyword">return</span> wordTotals.GetCount(*word), <span class="hljs-literal">true</span>
}
</code></pre>
<p><code>WordTotals</code> isn&apos;t all that interesting. When we <code>Update</code>, we check to see if we have seen the word before and if not, add it to our map of words and set the count to one. If we have seen the word before, we increment its count. <code>GetCount</code> looks up a word and returns a <code>WordCount</code> for it.</p>
<pre><code class="lang-go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">MakeWordTotals</span><span class="hljs-params">()</span> *<span class="hljs-title">WordTotals</span></span> {
    <span class="hljs-keyword">return</span> &amp;WordTotals{ <span class="hljs-built_in">make</span>(<span class="hljs-keyword">map</span>[<span class="hljs-keyword">string</span>]<span class="hljs-keyword">uint64</span>) }
}

<span class="hljs-keyword">type</span> WordTotals <span class="hljs-keyword">struct</span> {
    WordTotals <span class="hljs-keyword">map</span>[<span class="hljs-keyword">string</span>]<span class="hljs-keyword">uint64</span>
}

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(wordTotals *WordTotals)</span> <span class="hljs-title">Update</span><span class="hljs-params">(word <span class="hljs-keyword">string</span>)</span></span> {
    total, found := wordTotals.WordTotals[word]
    <span class="hljs-keyword">if</span> !found {
        total = <span class="hljs-number">0</span>
    }
    wordTotals.WordTotals[word] = total + <span class="hljs-number">1</span>
}

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(wordTotals *WordTotals)</span> <span class="hljs-title">GetCount</span><span class="hljs-params">(word <span class="hljs-keyword">string</span>)</span> *<span class="hljs-title">WordCount</span></span> {
    <span class="hljs-keyword">return</span> &amp;WordCount{word, wordTotals.WordTotals[word]}
}
</code></pre>
<h3 id="hello-world-im-a-wordcount">Hello World! I&apos;m a <code>WordCount</code>.</h3>
<p>By this point, our word has almost made it to the end of the pipeline. The only thing left is the sink and encoding. We don&apos;t do anything fancy with our encoding. We take the word and its count, and we format it into a single line of text that our receiver can record.</p>
<pre><code class="lang-go"><span class="hljs-keyword">type</span> Encoder <span class="hljs-keyword">struct</span> {}

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(encoder *Encoder)</span> <span class="hljs-title">Encode</span><span class="hljs-params">(data <span class="hljs-keyword">interface</span>{})</span> []<span class="hljs-title">byte</span></span> {
    word_count := data.(*WordCount)
    msg := fmt.Sprintf(<span class="hljs-string">&quot;%s =&gt; %d\n&quot;</span>, word_count.Word, word_count.Count)
    fmt.Println(msg)
    <span class="hljs-keyword">return</span> []<span class="hljs-keyword">byte</span>(msg)
}
</code></pre>
<h3 id="running-wordcount">Running <code>word_count</code></h3>
<p>The complete example is available <a href="https://github.com/WallarooLabs/wallaroo/tree/release-0.4.4/examples/go/word_count/" target="_blank">here</a>. To run it, follow the <a href="https://github.com/WallarooLabs/wallaroo/tree/release-0.4.4/examples/go/word_count/README.md" target="_blank">Word Count application instructions</a></p>
<h3 id="next-steps">Next Steps</h3>
<p>Learn more about what, as an application programmer, you need to do for <a href="interworker-serialization-and-resilience.html">serialization</a> when writing a Wallaroo Go application. </p>

                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="writing-your-own-stateful-application.html" class="navigation navigation-prev " aria-label="Previous page: Writing Your Own Stateful Application">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
                <a href="interworker-serialization-and-resilience.html" class="navigation navigation-next " aria-label="Next page: Interworker Serialization and Resilience">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"Word Count","level":"5.3.3","depth":2,"next":{"title":"Interworker Serialization and Resilience","level":"5.3.4","depth":2,"path":"book/go/api/interworker-serialization-and-resilience.md","ref":"book/go/api/interworker-serialization-and-resilience.md","articles":[]},"previous":{"title":"Writing Your Own Stateful Application","level":"5.3.2","depth":2,"path":"book/go/api/writing-your-own-stateful-application.md","ref":"book/go/api/writing-your-own-stateful-application.md","articles":[]},"dir":"ltr"},"config":{"gitbook":"*","theme":"default","variables":{},"plugins":["highlight","footnote-string-to-number","ga","codetabs"],"pluginsConfig":{"search":{},"codetabs":{},"footnote-string-to-number":{},"lunr":{"maxIndexSize":1000000,"ignoreSpecialCharacters":false},"fontsettings":{"theme":"white","family":"sans","size":2},"highlight":{},"ga":{"configuration":"auto","token":"UA-59652249-3"},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false}},"structure":{"langs":"LANGS.md","readme":"intro.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56},"footerTemplate":"©2017 All Rights Reserved, Wallaroo Labs"},"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"}},"file":{"path":"book/go/api/word-count.md","mtime":"2018-05-31T14:04:32.612Z","type":"markdown"},"gitbook":{"version":"3.2.3","time":"2018-05-31T14:04:39.977Z"},"basePath":"../../..","book":{"language":""}});
        });
    </script>
</div>

        
    <script src="../../../gitbook/gitbook.js"></script>
    <script src="../../../gitbook/theme.js"></script>
    
        
        <script src="../../../gitbook/gitbook-plugin-ga/plugin.js"></script>
        
    
        
        <script src="../../../gitbook/gitbook-plugin-codetabs/codetabs.js"></script>
        
    
        
        <script src="../../../gitbook/gitbook-plugin-search/search-engine.js"></script>
        
    
        
        <script src="../../../gitbook/gitbook-plugin-search/search.js"></script>
        
    
        
        <script src="../../../gitbook/gitbook-plugin-lunr/lunr.min.js"></script>
        
    
        
        <script src="../../../gitbook/gitbook-plugin-lunr/search-lunr.js"></script>
        
    
        
        <script src="../../../gitbook/gitbook-plugin-sharing/buttons.js"></script>
        
    
        
        <script src="../../../gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

    </body>
</html>

