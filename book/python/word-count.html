
<!DOCTYPE HTML>
<html lang="" >
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>Word Count Â· GitBook</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.3">
        
        
        
    
    <link rel="stylesheet" href="../../gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-highlight/website.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-codetabs/codetabs.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-search/search.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
    
        
    
        
    
        
    
        
    
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../../gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="../../gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="interworker-serialization-and-resilience.html" />
    
    
    <link rel="prev" href="writing-your-own-partitioned-stateful-application.html" />
    

    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="Type to search" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        
    
        <li class="chapter " data-level="1.1" data-path="../../">
            
                <a href="../../">
            
                    
                    Introduction
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2" data-path="../what-is-wallaroo.html">
            
                <a href="../what-is-wallaroo.html">
            
                    
                    What is Wallaroo?
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">Core Concepts</li>
        
        
    
        <li class="chapter " data-level="2.1" data-path="../core-concepts/intro.html">
            
                <a href="../core-concepts/intro.html">
            
                    
                    Introduction
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.2" data-path="../core-concepts/core-concepts.html">
            
                <a href="../core-concepts/core-concepts.html">
            
                    
                    Introducing Wallaroo Core Concepts
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.3" data-path="../core-concepts/state.html">
            
                <a href="../core-concepts/state.html">
            
                    
                    State
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.4" data-path="../core-concepts/working-with-state.html">
            
                <a href="../core-concepts/working-with-state.html">
            
                    
                    Working with State
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.5" data-path="../core-concepts/partitioning.html">
            
                <a href="../core-concepts/partitioning.html">
            
                    
                    Partitioning
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">Wallaroo Language Support</li>
        
        
    
        <li class="chapter " data-level="3.1" data-path="../language_support.html">
            
                <a href="../language_support.html">
            
                    
                    Wallaroo Languages Supported
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">Wallaroo with Python</li>
        
        
    
        <li class="chapter " data-level="4.1" data-path="intro.html">
            
                <a href="intro.html">
            
                    
                    Wallaroo with Python Introduction
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.2" data-path="../getting-started/setting-up-your-environment.html">
            
                <a href="../getting-started/setting-up-your-environment.html">
            
                    
                    Setting up Your Environment
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="4.2.1" data-path="../getting-started/choosing-an-installation-option.html">
            
                <a href="../getting-started/choosing-an-installation-option.html">
            
                    
                    Choosing an Installation Option
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.2.2" data-path="../getting-started/installing-with-docker.html">
            
                <a href="../getting-started/installing-with-docker.html">
            
                    
                    Installing with Docker
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="4.2.2.1" data-path="../getting-started/docker-setup.html">
            
                <a href="../getting-started/docker-setup.html">
            
                    
                    Setting Up Your Environment
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.2.2.2" data-path="../getting-started/run-a-wallaroo-application-docker.html">
            
                <a href="../getting-started/run-a-wallaroo-application-docker.html">
            
                    
                    Run a Wallaroo Application in Docker
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="4.2.3" data-path="../getting-started/installing-with-vagrant.html">
            
                <a href="../getting-started/installing-with-vagrant.html">
            
                    
                    Installing with Vagrant
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="4.2.3.1" data-path="../getting-started/vagrant-setup.html">
            
                <a href="../getting-started/vagrant-setup.html">
            
                    
                    Setting Up Your Environment
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.2.3.2" data-path="../getting-started/run-a-wallaroo-application-vagrant.html">
            
                <a href="../getting-started/run-a-wallaroo-application-vagrant.html">
            
                    
                    Run a Wallaroo Application in Vagrant
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="4.2.4" data-path="../getting-started/wallaroo-up.html">
            
                <a href="../getting-started/wallaroo-up.html">
            
                    
                    Installing with Wallaroo Up
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="4.2.4.1" data-path="../getting-started/run-a-wallaroo-application-wallaroo-up.html">
            
                <a href="../getting-started/run-a-wallaroo-application-wallaroo-up.html">
            
                    
                    Run a Wallaroo Application
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="4.2.5" data-path="../getting-started/installing-from-source.html">
            
                <a href="../getting-started/installing-from-source.html">
            
                    
                    Installing From Source
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="4.2.5.1" data-path="../getting-started/setup.html">
            
                <a href="../getting-started/setup.html">
            
                    
                    Setting up Your Environment
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="4.2.5.1.1" data-path="../getting-started/linux-setup.html">
            
                <a href="../getting-started/linux-setup.html">
            
                    
                    Ubuntu Installation
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="4.2.5.2" data-path="../getting-started/run-a-wallaroo-application.html">
            
                <a href="../getting-started/run-a-wallaroo-application.html">
            
                    
                    Run a Wallaroo Application
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="4.2.6" data-path="../getting-started/starting-a-new-shell.html">
            
                <a href="../getting-started/starting-a-new-shell.html">
            
                    
                    Starting a new shell for Wallaroo
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.2.7" data-path="../getting-started/conclusion.html">
            
                <a href="../getting-started/conclusion.html">
            
                    
                    Conclusion
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="4.3" data-path="wallaroo-python-api.html">
            
                <a href="wallaroo-python-api.html">
            
                    
                    Wallaroo Python API
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="4.3.1" data-path="running-a-wallaroo-python-application.html">
            
                <a href="running-a-wallaroo-python-application.html">
            
                    
                    Running a Wallaroo Python Application
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.3.2" data-path="writing-your-own-application.html">
            
                <a href="writing-your-own-application.html">
            
                    
                    Writing Your Own Application
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.3.3" data-path="writing-your-own-stateful-application.html">
            
                <a href="writing-your-own-stateful-application.html">
            
                    
                    Writing Your Own Stateful Application
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.3.4" data-path="writing-your-own-partitioned-stateful-application.html">
            
                <a href="writing-your-own-partitioned-stateful-application.html">
            
                    
                    Writing Your Own Partitioned Stateful Application
            
                </a>
            

            
        </li>
    
        <li class="chapter active" data-level="4.3.5" data-path="word-count.html">
            
                <a href="word-count.html">
            
                    
                    Word Count
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.3.6" data-path="interworker-serialization-and-resilience.html">
            
                <a href="interworker-serialization-and-resilience.html">
            
                    
                    Interworker Serialization and Resilience
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.3.7" data-path="using-connectors.html">
            
                <a href="using-connectors.html">
            
                    
                    Using Connectors
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.3.8" data-path="api.html">
            
                <a href="api.html">
            
                    
                    Wallaroo Python API
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="4.4" >
            
                <span>
            
                    
                    Debugging Python Wallaroo Applications
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="4.4.1" data-path="debugging.html">
            
                <a href="debugging.html">
            
                    
                    Debugging
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

    
        
        <li class="header">Wallaroo with Go</li>
        
        
    
        <li class="chapter " data-level="5.1" data-path="../go/intro.html">
            
                <a href="../go/intro.html">
            
                    
                    Go API Introduction
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.2" data-path="../go/getting-started/setting-up-your-environment.html">
            
                <a href="../go/getting-started/setting-up-your-environment.html">
            
                    
                    Setting up Your Environment
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="5.2.1" data-path="../go/getting-started/choosing-an-installation-option.html">
            
                <a href="../go/getting-started/choosing-an-installation-option.html">
            
                    
                    Choosing an Installation Option
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.2.2" data-path="../go/getting-started/installing-with-docker.html">
            
                <a href="../go/getting-started/installing-with-docker.html">
            
                    
                    Installing with Docker
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="5.2.2.1" data-path="../go/getting-started/docker-setup.html">
            
                <a href="../go/getting-started/docker-setup.html">
            
                    
                    Setting Up Your Environment
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.2.2.2" data-path="../go/getting-started/run-a-wallaroo-go-application-docker.html">
            
                <a href="../go/getting-started/run-a-wallaroo-go-application-docker.html">
            
                    
                    Run a Wallaroo Application in Docker
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="5.2.3" data-path="../go/getting-started/installing-with-vagrant.html">
            
                <a href="../go/getting-started/installing-with-vagrant.html">
            
                    
                    Installing with Vagrant
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="5.2.3.1" data-path="../go/getting-started/vagrant-setup.html">
            
                <a href="../go/getting-started/vagrant-setup.html">
            
                    
                    Setting Up Your Environment
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.2.3.2" data-path="../go/getting-started/run-a-wallaroo-go-application-vagrant.html">
            
                <a href="../go/getting-started/run-a-wallaroo-go-application-vagrant.html">
            
                    
                    Run a Wallaroo Go Application in Vagrant
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="5.2.4" data-path="../go/getting-started/wallaroo-up.html">
            
                <a href="../go/getting-started/wallaroo-up.html">
            
                    
                    Installing with Wallaroo Up
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="5.2.4.1" data-path="../go/getting-started/run-a-wallaroo-go-application-wallaroo-up.html">
            
                <a href="../go/getting-started/run-a-wallaroo-go-application-wallaroo-up.html">
            
                    
                    Run a Wallaroo Go Application
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="5.2.5" data-path="../go/getting-started/installing-from-source.html">
            
                <a href="../go/getting-started/installing-from-source.html">
            
                    
                    Installing From Source
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="5.2.5.1" data-path="../go/getting-started/setup.html">
            
                <a href="../go/getting-started/setup.html">
            
                    
                    Setting up Your Environment
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="5.2.5.1.1" data-path="../go/getting-started/linux-setup.html">
            
                <a href="../go/getting-started/linux-setup.html">
            
                    
                    Ubuntu Installation
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="5.2.5.2" data-path="../go/getting-started/run-a-wallaroo-go-application.html">
            
                <a href="../go/getting-started/run-a-wallaroo-go-application.html">
            
                    
                    Run a Wallaroo Go Application
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="5.2.6" data-path="../go/getting-started/starting-a-new-shell.html">
            
                <a href="../go/getting-started/starting-a-new-shell.html">
            
                    
                    Starting a new shell for Wallaroo
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.2.7" data-path="../go/getting-started/conclusion.html">
            
                <a href="../go/getting-started/conclusion.html">
            
                    
                    Conclusion
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="5.3" data-path="../go/api/wallaroo-go-api.html">
            
                <a href="../go/api/wallaroo-go-api.html">
            
                    
                    Wallaroo Go API
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="5.3.1" data-path="../go/api/writing-your-own-application.html">
            
                <a href="../go/api/writing-your-own-application.html">
            
                    
                    Writing Your Own Application
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.3.2" data-path="../go/api/writing-your-own-stateful-application.html">
            
                <a href="../go/api/writing-your-own-stateful-application.html">
            
                    
                    Writing Your Own Stateful Application
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.3.3" data-path="../go/api/word-count.html">
            
                <a href="../go/api/word-count.html">
            
                    
                    Word Count
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.3.4" data-path="../go/api/interworker-serialization-and-resilience.html">
            
                <a href="../go/api/interworker-serialization-and-resilience.html">
            
                    
                    Interworker Serialization and Resilience
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.3.5" data-path="../go/api/start-a-project.html">
            
                <a href="../go/api/start-a-project.html">
            
                    
                    Start A Go Project
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.3.6" data-path="../go/api/api.html">
            
                <a href="../go/api/api.html">
            
                    
                    Wallaroo Go API
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

    
        
        <li class="header">Running Wallaroo</li>
        
        
    
        <li class="chapter " data-level="6.1" data-path="../running-wallaroo/running-wallaroo.html">
            
                <a href="../running-wallaroo/running-wallaroo.html">
            
                    
                    Running Wallaroo
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="6.2" data-path="../running-wallaroo/autoscale.html">
            
                <a href="../running-wallaroo/autoscale.html">
            
                    
                    Autoscale
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="6.3" data-path="../running-wallaroo/resilience.html">
            
                <a href="../running-wallaroo/resilience.html">
            
                    
                    Resilience
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="6.4" data-path="../running-wallaroo/wallaroo-command-line-options.html">
            
                <a href="../running-wallaroo/wallaroo-command-line-options.html">
            
                    
                    Command line options
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">Appendix</li>
        
        
    
        <li class="chapter " data-level="7.1" data-path="../appendix/virtualenv.html">
            
                <a href="../appendix/virtualenv.html">
            
                    
                    Wallaroo and Virtualenv
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="7.2" data-path="../appendix/tcp-decoders-and-encoders.html">
            
                <a href="../appendix/tcp-decoders-and-encoders.html">
            
                    
                    TCP Decoders and Encoders
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="7.3" data-path="../wallaroo-tools/giles-sender.html">
            
                <a href="../wallaroo-tools/giles-sender.html">
            
                    
                    Sending Data over TCP with Giles Sender
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="7.4" data-path="../wallaroo-tools/giles-receiver.html">
            
                <a href="../wallaroo-tools/giles-receiver.html">
            
                    
                    Receiving Data over TCP with Giles Receiver
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="7.5" data-path="../metrics/metrics-ui.html">
            
                <a href="../metrics/metrics-ui.html">
            
                    
                    Monitoring Metrics with the Monitoring Hub
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="7.6" data-path="../appendix/decoding-giles-receiver-output.html">
            
                <a href="../appendix/decoding-giles-receiver-output.html">
            
                    
                    Decoding Giles Receiver Output
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="7.7" data-path="../appendix/wallaroo-and-long-running-data-processing-and-other-workflows.html">
            
                <a href="../appendix/wallaroo-and-long-running-data-processing-and-other-workflows.html">
            
                    
                    Wallaroo and Long-Running Data Processing and Other Workflows
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="7.8" data-path="../appendix/wallaroo-in-docker-tips.html">
            
                <a href="../appendix/wallaroo-in-docker-tips.html">
            
                    
                    Tips for using Wallaroo in Docker
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">Legal</li>
        
        
    

    
        
        <li class="header">* Terms and Conditions</li>
        
        
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            Published with GitBook
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href="../.." >Word Count</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <h1 id="bringing-it-all-together-with-word-count">Bringing it all together with word count</h1>
<p>Word count is the canonical streaming data application. It&apos;s canonical not because everyone needs to count words but because it&apos;s a good platform for demonstrating how to do many of the everyday tasks in a streaming application.</p>
<p>This section will take you through our <a href="https://github.com/WallarooLabs/wallaroo/tree/release-0.5.3/examples/python/word_count/" target="_blank">Wallaroo word count example</a>. Along the way, we will introduce you to a couple of new concepts: parallelizing stateless computations, and splitting one incoming message into several outgoing ones.</p>
<h2 id="word-count">Word count</h2>
<p>Our word counting application receives text input in the form of chunks of text. It then splits those chunks into lines and from there into individual words. We then send those words to a stateful partition where we increment the running count and finally, after updating, send as output the word and its current count.</p>
<h3 id="application-setup">Application Setup</h3>
<p>Let&apos;s dive in and take a look at our application setup:</p>
<pre><code class="lang-python"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">application_setup</span><span class="hljs-params">(args)</span>:</span>
    in_host, in_port = wallaroo.tcp_parse_input_addrs(args)[<span class="hljs-number">0</span>]
    out_host, out_port = wallaroo.tcp_parse_output_addrs(args)[<span class="hljs-number">0</span>]

    word_partitions = list(string.ascii_lowercase)
    word_partitions.append(<span class="hljs-string">&quot;!&quot;</span>)

    ab = wallaroo.ApplicationBuilder(<span class="hljs-string">&quot;Word Count Application&quot;</span>)
    ab.new_pipeline(<span class="hljs-string">&quot;Split and Count&quot;</span>,
                    wallaroo.TCPSourceConfig(in_host, in_port, decoder))
    ab.to_parallel(split)
    ab.to_state_partition(count_word, WordTotals, <span class="hljs-string">&quot;word totals&quot;</span>,
        partition, word_partitions)
    ab.to_sink(wallaroo.TCPSinkConfig(out_host, out_port, encoder))
    <span class="hljs-keyword">return</span> ab.build()
</code></pre>
<p>By now, hopefully, most of this looks somewhat familiar. We&apos;re building on concepts we&apos;ve seen in our previous example applications. We set up a new application with a single pipeline:</p>
<pre><code class="lang-python">ab = wallaroo.ApplicationBuilder(<span class="hljs-string">&quot;Word Count Application&quot;</span>)
ab.new_pipeline(<span class="hljs-string">&quot;Split and Count&quot;</span>,
                wallaroo.TCPSourceConfig(in_host, in_port, decoder))
</code></pre>
<p>Upon receiving some textual input, our word count application will route it to a stateless computation called <code>split</code>. <code>split</code> is responsible for breaking the text down into individual words. You might notice something a little different about how we set up this stateless computation. In our previous example, we called <code>to</code> on our application builder. In this case, we are calling <code>to_parallel</code>. What&apos;s the difference between <code>to</code> and <code>to_parallel</code>? The <code>to</code> method creates a single instance of the stateless computation. No matter how many workers we might run in our Wallaroo cluster, there will only be a single instance of the computation. Every message that is processed by the computation will need to be routed the worker running that computation. <code>to_parallel</code> is different. By doing <code>to_parallel(split)</code>, we are placing the <code>split</code> computation on every worker in our cluster.</p>
<h3 id="a-to-vs-toparallel-digression">A <code>to</code> vs <code>to_parallel</code> digression</h3>
<p>Parallelizing a stateless computation seems like something you&apos;d always want to do. So why does <code>to</code> exist? Message ordering. Some applications require that all incoming messages maintain ordering. Some don&apos;t. If we don&apos;t care about message order, we probably want to use <code>to_parallel</code>.</p>
<p>Imagine that our word splitting application has the following two blocks of text arrive:</p>
<pre><code class="lang-text">BLOCK 1:

Hello there, how are you?

BLOCK 2:

Fred needs help.
</code></pre>
<p>In the case of word count, it doesn&apos;t matter what order we count the messages. We just want to do it quickly. <code>to_parallel</code> is our friend. However, if all words starting with the letter &quot;h&quot; were going to be sent along to the same state computation after splitting <strong>and</strong> the order they arrived was important than <code>to_parallel</code> would not be our friend. If the state computation that deals with the letter &quot;h&quot; needs to see &quot;Hello&quot; then &quot;how&quot; and then &quot;help&quot;, you have to use <code>to</code>. It will maintain ordering by processing the incoming blocks sequentially rather than in parallel.</p>
<p>In our current case, counting words, we don&apos;t care about the order of the words, so <code>to_parallel</code> is fine.</p>
<h3 id="application-setup-the-return">Application setup, the return</h3>
<p>Back to our application setup:</p>
<pre><code class="lang-python"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">application_setup</span><span class="hljs-params">(args)</span>:</span>
    in_host, in_port = wallaroo.tcp_parse_input_addrs(args)[<span class="hljs-number">0</span>]
    out_host, out_port = wallaroo.tcp_parse_output_addrs(args)[<span class="hljs-number">0</span>]

    word_partitions = list(string.ascii_lowercase)
    word_partitions.append(<span class="hljs-string">&quot;!&quot;</span>)

    ab = wallaroo.ApplicationBuilder(<span class="hljs-string">&quot;Word Count Application&quot;</span>)
    ab.new_pipeline(<span class="hljs-string">&quot;Split and Count&quot;</span>,
                    wallaroo.TCPSourceConfig(in_host, in_port, decoder))
    ab.to_parallel(split)
    ab.to_state_partition(count_word, WordTotals, <span class="hljs-string">&quot;word totals&quot;</span>,
        partition, word_partitions)
    ab.to_sink(wallaroo.TCPSinkConfig(out_host, out_port, encoder))
    <span class="hljs-keyword">return</span> ab.build()
</code></pre>
<p>Beyond <code>to_parallel</code>, there&apos;s nothing new in our word count application. After we split our text chunks into words, they get routed to a state partition where they are counted.</p>
<pre><code class="lang-python">    ab.to_state_partition(count_word, WordTotals, <span class="hljs-string">&quot;word totals&quot;</span>,
        partition, word_partitions)
</code></pre>
<p>Note we set up 27 partitions to count our words, one for each letter plus one called &quot;!&quot; which will handle any &quot;word&quot; that doesn&apos;t start with a letter:</p>
<pre><code class="lang-python">word_partitions = list(string.ascii_lowercase)
word_partitions.append(<span class="hljs-string">&quot;!&quot;</span>)

...

ab.to_state_partition(count_word, WordTotals, <span class="hljs-string">&quot;word totals&quot;</span>,
    partition, word_partitions)
</code></pre>
<h3 id="splitting-words">Splitting words</h3>
<p>Our word splitting is mostly uninteresting, except for one huge difference: our previous examples had one output for each input. When splitting text into words, we take one input and produce multiple outputs. Let&apos;s see how that is done.</p>
<pre><code class="lang-python"><span class="hljs-meta">@wallaroo.computation_multi(name=&quot;split into words&quot;)</span>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">split</span><span class="hljs-params">(data)</span>:</span>
    punctuation = <span class="hljs-string">&quot; !\&quot;#$%&amp;&apos;()*+,-./:;&lt;=&gt;?@[\]^_`{|}~&quot;</span>

    words = []

    <span class="hljs-keyword">for</span> line <span class="hljs-keyword">in</span> data.split(<span class="hljs-string">&quot;\n&quot;</span>):
        clean_line = line.lower().strip(punctuation)
        <span class="hljs-keyword">for</span> word <span class="hljs-keyword">in</span> clean_line.split(<span class="hljs-string">&apos; &apos;</span>):
            clean_word = word.strip(punctuation)
            words.append(clean_word)

    <span class="hljs-keyword">return</span> words
</code></pre>
<p>Did you catch what is going on? Previously, we&apos;ve seen our stateless computations wrapped by the <code>computation</code> decorator. Why do we have both <code>computation</code> and <code>computation_multi</code>? The answer lies in Python&apos;s type system.</p>
<h3 id="computation-vs-computationmulti"><code>computation</code> vs <code>computation_multi</code></h3>
<p>Wallaroo&apos;s Python API allows a programmer to indicate that the output of a computation is meant to be treated as a single output by using the <code>compute</code> method. This allows us, for example, to split some text into words and have that list of words treated as a single item by Wallaroo. In our word splitting case, that isn&apos;t what we want. We want each word to be handled individually. <code>compute_multi</code> lets us tell Wallaroo that each of these words is a new message and should be handled individually.</p>
<p>By using <code>computation_multi</code>, each word will be handled individually. This allows us to then route each one based on its first letter for counting. If you look below, you can see that our word partitioning function is expecting words, not a list, which makes sense.</p>
<pre><code class="lang-python"><span class="hljs-meta">@wallaroo.partition</span>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">partition</span><span class="hljs-params">(data)</span>:</span>
    <span class="hljs-keyword">if</span> data[<span class="hljs-number">0</span>] &gt;= <span class="hljs-string">&apos;a&apos;</span> <span class="hljs-keyword">and</span> data[<span class="hljs-number">0</span>] &lt;= <span class="hljs-string">&apos;z&apos;</span>:
        <span class="hljs-keyword">return</span> data[<span class="hljs-number">0</span>]
    <span class="hljs-keyword">else</span>:
        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;!&quot;</span>
</code></pre>
<h3 id="our-counting-guts">Our counting guts</h3>
<p>The next three classes are the core of our word counting application. By this point, our messages have been split into individual words and run through our <code>partition</code> function and will arrive at a state computation based on the first letter of the word.</p>
<p>Let&apos;s take a look at what we have. <code>CountWord</code> is a state computation. When it&apos;s run, we update our <code>word_totals</code> state to reflect the new incoming <code>word</code>. Then, it returns a tuple of the return value from <code>word_totals.get_count</code> and <code>True</code>. The return value of <code>get_count</code> is an instance of the <code>WordCount</code> class containing the word and its current count.</p>
<pre><code class="lang-python"><span class="hljs-meta">@wallaroo.state_computation(name=&quot;Count Word&quot;)</span>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">count_word</span><span class="hljs-params">(word, word_totals)</span>:</span>
    word_totals.update(word)
    <span class="hljs-keyword">return</span> (word_totals.get_count(word), <span class="hljs-keyword">True</span>)


<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">WordCount</span><span class="hljs-params">(object)</span>:</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span><span class="hljs-params">(self, word, count)</span>:</span>
        self.word = word
        self.count = count
</code></pre>
<p><code>WordTotals</code> isn&apos;t all that interesting. When we <code>update</code>, we check to see if we have seen the word before and if not, add it to our map of words and set the count to one. If we have seen the word before, we increment its count. <code>get_count</code> looks up a word and returns a <code>WordCount</code> for it.</p>
<pre><code class="lang-python"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">WordTotals</span><span class="hljs-params">(object)</span>:</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span><span class="hljs-params">(self)</span>:</span>
        self.word_totals = {}

    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">update</span><span class="hljs-params">(self, word)</span>:</span>
        <span class="hljs-keyword">if</span> self.word_totals.has_key(word):
            self.word_totals[word] = self.word_totals[word] + <span class="hljs-number">1</span>
        <span class="hljs-keyword">else</span>:
            self.word_totals[word] = <span class="hljs-number">1</span>

    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_count</span><span class="hljs-params">(self, word)</span>:</span>
        <span class="hljs-keyword">return</span> WordCount(word, self.word_totals[word])
</code></pre>
<h3 id="hello-world-im-a-wordcount">Hello world! I&apos;m a <code>WordCount</code>.</h3>
<p>By this point, our word has almost made it to the end of the pipeline. The only thing left is the sink and encoding. We don&apos;t do anything fancy with our encoding. We take the word and its count, and we format it into a single line of text that our receiver can record.</p>
<pre><code class="lang-python"><span class="hljs-meta">@wallaroo.encoder</span>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">encoder</span><span class="hljs-params">(data)</span>:</span>
    <span class="hljs-keyword">return</span> data.word + <span class="hljs-string">&quot; =&gt; &quot;</span> + str(data.count) + <span class="hljs-string">&quot;\n&quot;</span>
</code></pre>
<h3 id="running-wordcountpy">Running <code>word_count.py</code></h3>
<p>The complete example is available <a href="https://github.com/WallarooLabs/wallaroo/tree/release-0.5.3/examples/python/word_count/" target="_blank">here</a>. To run it, follow the <a href="https://github.com/WallarooLabs/wallaroo/tree/release-0.5.3/examples/python/word_count/README.md" target="_blank">Word Count application instructions</a></p>
<h3 id="next-steps">Next Steps</h3>
<p>To learn how to make your application resilient and able to work across multiple workers, please continue to <a href="interworker-serialization-and-resilience.html">Inter-worker Serialization and Resilience</a>.</p>
<p>For further reading, please refer to the <a href="api.html">Wallaroo Python API Classes</a>.</p>

                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="writing-your-own-partitioned-stateful-application.html" class="navigation navigation-prev " aria-label="Previous page: Writing Your Own Partitioned Stateful Application">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
                <a href="interworker-serialization-and-resilience.html" class="navigation navigation-next " aria-label="Next page: Interworker Serialization and Resilience">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"Word Count","level":"4.3.5","depth":2,"next":{"title":"Interworker Serialization and Resilience","level":"4.3.6","depth":2,"path":"book/python/interworker-serialization-and-resilience.md","ref":"book/python/interworker-serialization-and-resilience.md","articles":[]},"previous":{"title":"Writing Your Own Partitioned Stateful Application","level":"4.3.4","depth":2,"path":"book/python/writing-your-own-partitioned-stateful-application.md","ref":"book/python/writing-your-own-partitioned-stateful-application.md","articles":[]},"dir":"ltr"},"config":{"gitbook":"*","theme":"default","variables":{},"plugins":["highlight","footnote-string-to-number","ga","codetabs"],"pluginsConfig":{"search":{},"codetabs":{},"footnote-string-to-number":{},"lunr":{"maxIndexSize":1000000,"ignoreSpecialCharacters":false},"fontsettings":{"theme":"white","family":"sans","size":2},"highlight":{},"ga":{"configuration":"auto","token":"UA-59652249-3"},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false}},"structure":{"langs":"LANGS.md","readme":"intro.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56},"footerTemplate":"Â©2017 All Rights Reserved, Wallaroo Labs"},"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"}},"file":{"path":"book/python/word-count.md","mtime":"2018-09-27T03:16:12.785Z","type":"markdown"},"gitbook":{"version":"3.2.3","time":"2018-09-27T03:16:19.938Z"},"basePath":"../..","book":{"language":""}});
        });
    </script>
</div>

        
    <script src="../../gitbook/gitbook.js"></script>
    <script src="../../gitbook/theme.js"></script>
    
        
        <script src="../../gitbook/gitbook-plugin-ga/plugin.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-codetabs/codetabs.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-search/search-engine.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-search/search.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-lunr/lunr.min.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-lunr/search-lunr.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-sharing/buttons.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

    </body>
</html>

