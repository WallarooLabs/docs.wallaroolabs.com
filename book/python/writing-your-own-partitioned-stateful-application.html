
<!DOCTYPE HTML>
<html lang="" >
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>Writing Your Own Partitioned Stateful Application Â· GitBook</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.3">
        
        
        
    
    <link rel="stylesheet" href="../../gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-highlight/website.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-codetabs/codetabs.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-search/search.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
    
        
    
        
    
        
    
        
    
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../../gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="../../gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="word-count.html" />
    
    
    <link rel="prev" href="writing-your-own-stateful-application.html" />
    

    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="Type to search" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        
    
        <li class="chapter " data-level="1.1" data-path="../../">
            
                <a href="../../">
            
                    
                    Introduction
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2" data-path="../what-is-wallaroo.html">
            
                <a href="../what-is-wallaroo.html">
            
                    
                    What is Wallaroo?
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">Core Concepts</li>
        
        
    
        <li class="chapter " data-level="2.1" data-path="../core-concepts/intro.html">
            
                <a href="../core-concepts/intro.html">
            
                    
                    Introduction
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.2" data-path="../core-concepts/core-concepts.html">
            
                <a href="../core-concepts/core-concepts.html">
            
                    
                    Introducing Wallaroo Core Concepts
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.3" data-path="../core-concepts/state.html">
            
                <a href="../core-concepts/state.html">
            
                    
                    State
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.4" data-path="../core-concepts/working-with-state.html">
            
                <a href="../core-concepts/working-with-state.html">
            
                    
                    Working with State
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.5" data-path="../core-concepts/partitioning.html">
            
                <a href="../core-concepts/partitioning.html">
            
                    
                    Partitioning
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">Wallaroo Language Support</li>
        
        
    
        <li class="chapter " data-level="3.1" data-path="../language_support.html">
            
                <a href="../language_support.html">
            
                    
                    Wallaroo Languages Supported
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">Wallaroo with Python</li>
        
        
    
        <li class="chapter " data-level="4.1" data-path="intro.html">
            
                <a href="intro.html">
            
                    
                    Wallaroo with Python Introduction
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.2" data-path="../getting-started/setting-up-your-environment.html">
            
                <a href="../getting-started/setting-up-your-environment.html">
            
                    
                    Setting up Your Environment
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="4.2.1" data-path="../getting-started/choosing-an-installation-option.html">
            
                <a href="../getting-started/choosing-an-installation-option.html">
            
                    
                    Choosing an Installation Option
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.2.2" data-path="../getting-started/installing-with-docker.html">
            
                <a href="../getting-started/installing-with-docker.html">
            
                    
                    Installing with Docker
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="4.2.2.1" data-path="../getting-started/docker-setup.html">
            
                <a href="../getting-started/docker-setup.html">
            
                    
                    Setting Up Your Environment
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.2.2.2" data-path="../getting-started/run-a-wallaroo-application-docker.html">
            
                <a href="../getting-started/run-a-wallaroo-application-docker.html">
            
                    
                    Run a Wallaroo Application in Docker
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="4.2.3" data-path="../getting-started/installing-with-vagrant.html">
            
                <a href="../getting-started/installing-with-vagrant.html">
            
                    
                    Installing with Vagrant
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="4.2.3.1" data-path="../getting-started/vagrant-setup.html">
            
                <a href="../getting-started/vagrant-setup.html">
            
                    
                    Setting Up Your Environment
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.2.3.2" data-path="../getting-started/run-a-wallaroo-application-vagrant.html">
            
                <a href="../getting-started/run-a-wallaroo-application-vagrant.html">
            
                    
                    Run a Wallaroo Application in Vagrant
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="4.2.4" data-path="../getting-started/wallaroo-up.html">
            
                <a href="../getting-started/wallaroo-up.html">
            
                    
                    Installing with Wallaroo Up
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="4.2.4.1" data-path="../getting-started/run-a-wallaroo-application-wallaroo-up.html">
            
                <a href="../getting-started/run-a-wallaroo-application-wallaroo-up.html">
            
                    
                    Run a Wallaroo Application
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="4.2.5" data-path="../getting-started/installing-from-source.html">
            
                <a href="../getting-started/installing-from-source.html">
            
                    
                    Installing From Source
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="4.2.5.1" data-path="../getting-started/setup.html">
            
                <a href="../getting-started/setup.html">
            
                    
                    Setting up Your Environment
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="4.2.5.1.1" data-path="../getting-started/linux-setup.html">
            
                <a href="../getting-started/linux-setup.html">
            
                    
                    Ubuntu Installation
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="4.2.5.2" data-path="../getting-started/run-a-wallaroo-application.html">
            
                <a href="../getting-started/run-a-wallaroo-application.html">
            
                    
                    Run a Wallaroo Application
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="4.2.6" data-path="../getting-started/starting-a-new-shell.html">
            
                <a href="../getting-started/starting-a-new-shell.html">
            
                    
                    Starting a new shell for Wallaroo
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.2.7" data-path="../getting-started/conclusion.html">
            
                <a href="../getting-started/conclusion.html">
            
                    
                    Conclusion
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="4.3" data-path="wallaroo-python-api.html">
            
                <a href="wallaroo-python-api.html">
            
                    
                    Wallaroo Python API
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="4.3.1" data-path="running-a-wallaroo-python-application.html">
            
                <a href="running-a-wallaroo-python-application.html">
            
                    
                    Running a Wallaroo Python Application
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.3.2" data-path="writing-your-own-application.html">
            
                <a href="writing-your-own-application.html">
            
                    
                    Writing Your Own Application
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.3.3" data-path="writing-your-own-stateful-application.html">
            
                <a href="writing-your-own-stateful-application.html">
            
                    
                    Writing Your Own Stateful Application
            
                </a>
            

            
        </li>
    
        <li class="chapter active" data-level="4.3.4" data-path="writing-your-own-partitioned-stateful-application.html">
            
                <a href="writing-your-own-partitioned-stateful-application.html">
            
                    
                    Writing Your Own Partitioned Stateful Application
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.3.5" data-path="word-count.html">
            
                <a href="word-count.html">
            
                    
                    Word Count
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.3.6" data-path="interworker-serialization-and-resilience.html">
            
                <a href="interworker-serialization-and-resilience.html">
            
                    
                    Interworker Serialization and Resilience
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.3.7" data-path="api.html">
            
                <a href="api.html">
            
                    
                    Wallaroo Python API
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="4.4" >
            
                <span>
            
                    
                    Debugging Python Wallaroo Applications
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="4.4.1" data-path="debugging.html">
            
                <a href="debugging.html">
            
                    
                    Debugging
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

    
        
        <li class="header">Wallaroo with Go</li>
        
        
    
        <li class="chapter " data-level="5.1" data-path="../go/intro.html">
            
                <a href="../go/intro.html">
            
                    
                    Go API Introduction
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.2" data-path="../go/getting-started/setting-up-your-environment.html">
            
                <a href="../go/getting-started/setting-up-your-environment.html">
            
                    
                    Setting up Your Environment
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="5.2.1" data-path="../go/getting-started/choosing-an-installation-option.html">
            
                <a href="../go/getting-started/choosing-an-installation-option.html">
            
                    
                    Choosing an Installation Option
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.2.2" data-path="../go/getting-started/installing-with-docker.html">
            
                <a href="../go/getting-started/installing-with-docker.html">
            
                    
                    Installing with Docker
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="5.2.2.1" data-path="../go/getting-started/docker-setup.html">
            
                <a href="../go/getting-started/docker-setup.html">
            
                    
                    Setting Up Your Environment
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.2.2.2" data-path="../go/getting-started/run-a-wallaroo-go-application-docker.html">
            
                <a href="../go/getting-started/run-a-wallaroo-go-application-docker.html">
            
                    
                    Run a Wallaroo Application in Docker
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="5.2.3" data-path="../go/getting-started/installing-with-vagrant.html">
            
                <a href="../go/getting-started/installing-with-vagrant.html">
            
                    
                    Installing with Vagrant
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="5.2.3.1" data-path="../go/getting-started/vagrant-setup.html">
            
                <a href="../go/getting-started/vagrant-setup.html">
            
                    
                    Setting Up Your Environment
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.2.3.2" data-path="../go/getting-started/run-a-wallaroo-go-application-vagrant.html">
            
                <a href="../go/getting-started/run-a-wallaroo-go-application-vagrant.html">
            
                    
                    Run a Wallaroo Go Application in Vagrant
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="5.2.4" data-path="../go/getting-started/wallaroo-up.html">
            
                <a href="../go/getting-started/wallaroo-up.html">
            
                    
                    Installing with Wallaroo Up
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="5.2.4.1" data-path="../go/getting-started/run-a-wallaroo-go-application-wallaroo-up.html">
            
                <a href="../go/getting-started/run-a-wallaroo-go-application-wallaroo-up.html">
            
                    
                    Run a Wallaroo Go Application
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="5.2.5" data-path="../go/getting-started/installing-from-source.html">
            
                <a href="../go/getting-started/installing-from-source.html">
            
                    
                    Installing From Source
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="5.2.5.1" data-path="../go/getting-started/setup.html">
            
                <a href="../go/getting-started/setup.html">
            
                    
                    Setting up Your Environment
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="5.2.5.1.1" data-path="../go/getting-started/linux-setup.html">
            
                <a href="../go/getting-started/linux-setup.html">
            
                    
                    Ubuntu Installation
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="5.2.5.2" data-path="../go/getting-started/run-a-wallaroo-go-application.html">
            
                <a href="../go/getting-started/run-a-wallaroo-go-application.html">
            
                    
                    Run a Wallaroo Go Application
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="5.2.6" data-path="../go/getting-started/starting-a-new-shell.html">
            
                <a href="../go/getting-started/starting-a-new-shell.html">
            
                    
                    Starting a new shell for Wallaroo
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.2.7" data-path="../go/getting-started/conclusion.html">
            
                <a href="../go/getting-started/conclusion.html">
            
                    
                    Conclusion
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="5.3" data-path="../go/api/wallaroo-go-api.html">
            
                <a href="../go/api/wallaroo-go-api.html">
            
                    
                    Wallaroo Go API
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="5.3.1" data-path="../go/api/writing-your-own-application.html">
            
                <a href="../go/api/writing-your-own-application.html">
            
                    
                    Writing Your Own Application
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.3.2" data-path="../go/api/writing-your-own-stateful-application.html">
            
                <a href="../go/api/writing-your-own-stateful-application.html">
            
                    
                    Writing Your Own Stateful Application
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.3.3" data-path="../go/api/word-count.html">
            
                <a href="../go/api/word-count.html">
            
                    
                    Word Count
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.3.4" data-path="../go/api/interworker-serialization-and-resilience.html">
            
                <a href="../go/api/interworker-serialization-and-resilience.html">
            
                    
                    Interworker Serialization and Resilience
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.3.5" data-path="../go/api/start-a-project.html">
            
                <a href="../go/api/start-a-project.html">
            
                    
                    Start A Go Project
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.3.6" data-path="../go/api/api.html">
            
                <a href="../go/api/api.html">
            
                    
                    Wallaroo Go API
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

    
        
        <li class="header">Running Wallaroo</li>
        
        
    
        <li class="chapter " data-level="6.1" data-path="../running-wallaroo/running-wallaroo.html">
            
                <a href="../running-wallaroo/running-wallaroo.html">
            
                    
                    Running Wallaroo
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="6.2" data-path="../running-wallaroo/autoscale.html">
            
                <a href="../running-wallaroo/autoscale.html">
            
                    
                    Autoscale
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="6.3" data-path="../running-wallaroo/resilience.html">
            
                <a href="../running-wallaroo/resilience.html">
            
                    
                    Resilience
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="6.4" data-path="../running-wallaroo/wallaroo-command-line-options.html">
            
                <a href="../running-wallaroo/wallaroo-command-line-options.html">
            
                    
                    Command line options
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">Appendix</li>
        
        
    
        <li class="chapter " data-level="7.1" data-path="../appendix/virtualenv.html">
            
                <a href="../appendix/virtualenv.html">
            
                    
                    Wallaroo and Virtualenv
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="7.2" data-path="../appendix/tcp-decoders-and-encoders.html">
            
                <a href="../appendix/tcp-decoders-and-encoders.html">
            
                    
                    TCP Decoders and Encoders
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="7.3" data-path="../wallaroo-tools/giles-sender.html">
            
                <a href="../wallaroo-tools/giles-sender.html">
            
                    
                    Sending Data over TCP with Giles Sender
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="7.4" data-path="../wallaroo-tools/giles-receiver.html">
            
                <a href="../wallaroo-tools/giles-receiver.html">
            
                    
                    Receiving Data over TCP with Giles Receiver
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="7.5" data-path="../metrics/metrics-ui.html">
            
                <a href="../metrics/metrics-ui.html">
            
                    
                    Monitoring Metrics with the Monitoring Hub
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="7.6" data-path="../appendix/decoding-giles-receiver-output.html">
            
                <a href="../appendix/decoding-giles-receiver-output.html">
            
                    
                    Decoding Giles Receiver Output
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="7.7" data-path="../appendix/wallaroo-and-long-running-data-processing-and-other-workflows.html">
            
                <a href="../appendix/wallaroo-and-long-running-data-processing-and-other-workflows.html">
            
                    
                    Wallaroo and Long-Running Data Processing and Other Workflows
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="7.8" data-path="../appendix/wallaroo-in-docker-tips.html">
            
                <a href="../appendix/wallaroo-in-docker-tips.html">
            
                    
                    Tips for using Wallaroo in Docker
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">Legal</li>
        
        
    

    
        
        <li class="header">* Terms and Conditions</li>
        
        
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            Published with GitBook
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href="../.." >Writing Your Own Partitioned Stateful Application</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <h1 id="writing-your-own-wallaroo-python-partitioned-stateful-application">Writing Your Own Wallaroo Python Partitioned Stateful Application</h1>
<p>In this section, we will go over how to write a partitioned stateful application with the Wallaroo Python API. If you haven&apos;t reviewed the simple stateless application and simple stateful application examples, you can find them <a href="writing-your-own-application.html">here</a> and <a href="writing-your-own-stateful-application.html">here</a>.</p>
<h2 id="partitioning">Partitioning</h2>
<p>Partitioning is a key aspect of how work is distributed in Wallaroo. From the application&apos;s point of view, what is required are:</p>
<ul>
<li>a partitioning function</li>
<li>partition-compatible states - the state should be defined in such a way that each partition can have its own distinct state instance</li>
</ul>
<p>A list of partition keys is optional. If included, your application will use these keys to set up the initial state partitions in the system. As we encounter new keys derived from messages using the user-defined partition function, we will dynamically create new state partitions. There is a slight performance penalty to dynamically creating state partitions in this way, so if you know all your keys ahead of time, it can be a good idea to provide them here.</p>
<h2 id="a-partitioned-stateful-application---alphabet-partitioned">A Partitioned Stateful Application - Alphabet (partitioned)</h2>
<p>Our partitioned application is going to be very similar to the Alphabet application. The difference is that it is going to use partitioning to distribute the work, and the state classes will need to reflect that.</p>
<p><strong>encode</strong>, <strong>decode</strong>, <strong>add_votes</strong>, and <strong>Votes</strong> are exactly the same as before, so we will not include them here.</p>
<h3 id="partition">Partition</h3>
<p>If we were to use partitioning in the alphabet application from the previous section, and we wanted to partition by key, then one way we could go about it is to create a partition key list, as illustrated here:</p>
<pre><code class="lang-python">letter_partitions = list(string.ascii_lowercase)
</code></pre>
<p>And then we define a partitioning function which returns a key from the above list for input data:</p>
<pre><code class="lang-python"><span class="hljs-meta">@wallaroo.partition</span>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">partition</span><span class="hljs-params">(data)</span>:</span>
    <span class="hljs-keyword">return</span> data.letter[<span class="hljs-number">0</span>]
</code></pre>
<p>Later when we build the application topology, we will pass both the keys and the function to the builder.</p>
<h3 id="state-and-statebuilder">State and StateBuilder</h3>
<p>Previously we had a state map called <code>AllVotes</code> that kept a <code>dict</code> of votes by letter:</p>
<pre><code class="lang-python"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">AllVotes</span><span class="hljs-params">(object)</span>:</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span><span class="hljs-params">(self)</span>:</span>
        self.votes_by_letter = {}
</code></pre>
<p>But since we are going to partition by letter, there is no reason to keep this structure. Instead, we will store the votes for a single letter in each state:</p>
<pre><code class="lang-python"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">TotalVotes</span><span class="hljs-params">(object)</span>:</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span><span class="hljs-params">(self)</span>:</span>
        self.letter = <span class="hljs-string">&apos;X&apos;</span>
        self.votes = <span class="hljs-number">0</span>

    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">update</span><span class="hljs-params">(self, votes)</span>:</span>
        self.letter = votes.letter
        self.votes += votes.votes

    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_votes</span><span class="hljs-params">(self)</span>:</span>
        <span class="hljs-keyword">return</span> Votes(self.letter, self.votes)
</code></pre>
<h3 id="application-setup">Application Setup</h3>
<p>Finally, the application setup is a little different now that we use partitioning. A partition is an intrinsic part of a pipeline&apos;s definition, as it changes how Wallaroo connects elements behind the scenes, so we have to distinguish partitioned state from non-partitioned state. This is done with <code>to_state_partition</code> (compared with <code>to_stateful</code> in the non-partitioned case, as in the previous section).</p>
<p>As with <code>to_stateful</code>, <code>to_state_partition</code> takes a state computation <em>function</em>, a state <em>class</em> and its name. In addition, it takes a partition function and a list of partition key strings:</p>
<pre><code class="lang-python">ab.to_state_partition(add_votes, TotalVotes, <span class="hljs-string">&quot;letter state&quot;</span>,
                      partition, letter_partitions)
</code></pre>
<p>So the new <code>application_setup</code> is going to look like</p>
<pre><code class="lang-python"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">application_setup</span><span class="hljs-params">(args)</span>:</span>
    in_host, in_port = wallaroo.tcp_parse_input_addrs(args)[<span class="hljs-number">0</span>]
    out_host, out_port = wallaroo.tcp_parse_output_addrs(args)[<span class="hljs-number">0</span>]

    letter_partitions = list(string.ascii_lowercase)
    ab = wallaroo.ApplicationBuilder(<span class="hljs-string">&quot;alphabet&quot;</span>)
    ab.new_pipeline(<span class="hljs-string">&quot;alphabet&quot;</span>,
                    wallaroo.TCPSourceConfig(in_host, in_port, decoder))
    ab.to_state_partition(add_votes, TotalVotes, <span class="hljs-string">&quot;letter state&quot;</span>,
                          partition, letter_partitions)
    ab.to_sink(wallaroo.TCPSinkConfig(out_host, out_port, encoder))
    <span class="hljs-keyword">return</span> ab.build()
</code></pre>
<h3 id="miscellaneous">Miscellaneous</h3>
<p>The imports used in this module are</p>
<pre><code class="lang-python"><span class="hljs-keyword">import</span> string
<span class="hljs-keyword">import</span> struct
<span class="hljs-keyword">import</span> wallaroo
</code></pre>
<h2 id="next-steps">Next Steps</h2>
<p>The complete alphabet example is available <a href="https://github.com/WallarooLabs/wallaroo/tree/release-0.5.3/examples/python/alphabet_partitioned/" target="_blank">here</a>. To run it, follow the <a href="https://github.com/WallarooLabs/wallaroo/tree/release-0.5.3/examples/python/alphabet_partitioned/README.md" target="_blank">Alphabet_partitioned application instructions</a></p>
<p>To see how everything we&apos;ve learned so far comes together, check out our <a href="word-count.html">Word Count walk-through</a></p>

                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="writing-your-own-stateful-application.html" class="navigation navigation-prev " aria-label="Previous page: Writing Your Own Stateful Application">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
                <a href="word-count.html" class="navigation navigation-next " aria-label="Next page: Word Count">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"Writing Your Own Partitioned Stateful Application","level":"4.3.4","depth":2,"next":{"title":"Word Count","level":"4.3.5","depth":2,"path":"book/python/word-count.md","ref":"book/python/word-count.md","articles":[]},"previous":{"title":"Writing Your Own Stateful Application","level":"4.3.3","depth":2,"path":"book/python/writing-your-own-stateful-application.md","ref":"book/python/writing-your-own-stateful-application.md","articles":[]},"dir":"ltr"},"config":{"gitbook":"*","theme":"default","variables":{},"plugins":["highlight","footnote-string-to-number","ga","codetabs"],"pluginsConfig":{"search":{},"codetabs":{},"footnote-string-to-number":{},"lunr":{"maxIndexSize":1000000,"ignoreSpecialCharacters":false},"fontsettings":{"theme":"white","family":"sans","size":2},"highlight":{},"ga":{"configuration":"auto","token":"UA-59652249-3"},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false}},"structure":{"langs":"LANGS.md","readme":"intro.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56},"footerTemplate":"Â©2017 All Rights Reserved, Wallaroo Labs"},"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"}},"file":{"path":"book/python/writing-your-own-partitioned-stateful-application.md","mtime":"2018-09-20T23:14:20.749Z","type":"markdown"},"gitbook":{"version":"3.2.3","time":"2018-09-20T23:14:29.560Z"},"basePath":"../..","book":{"language":""}});
        });
    </script>
</div>

        
    <script src="../../gitbook/gitbook.js"></script>
    <script src="../../gitbook/theme.js"></script>
    
        
        <script src="../../gitbook/gitbook-plugin-ga/plugin.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-codetabs/codetabs.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-search/search-engine.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-search/search.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-lunr/lunr.min.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-lunr/search-lunr.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-sharing/buttons.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

    </body>
</html>

