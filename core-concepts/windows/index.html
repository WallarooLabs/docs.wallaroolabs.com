<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    
    <title>Wallaroo  | Windows</title>
    <meta name="HandheldFriendly" content="True">
    <meta name="MobileOptimized" content="320">

    <meta name="viewport" content="width=device-width,minimum-scale=1">
    <meta name="generator" content="Hugo 0.52" />
    
    
      <META NAME="ROBOTS" CONTENT="NOINDEX, NOFOLLOW">
    

    <style>
      @font-face {
        font-family: 'Icon';
        src: url('/dist/fonts/icon.eot?52m981');
        src: url('/dist/fonts/icon.eot?#iefix52m981')
               format('embedded-opentype'),
             url('/dist/fonts/icon.woff?52m981')
               format('woff'),
             url('/dist/fonts/icon.ttf?52m981')
               format('truetype'),
             url('/dist/fonts/icon.svg?52m981#icon')
               format('svg');
        font-weight: normal;
        font-style: normal;
      }
    </style>

    <link href="/dist/css/app.css" rel="stylesheet">
    <link href="/dist/css/highlight.css" rel="stylesheet">
    <link href="/dist/css/icon.css" rel="stylesheet">
    <link href="/dist/css/wallaroo.css" rel="stylesheet">

    
      <link rel="stylesheet" href="/css/jquery-ui.min.css">
    
      <link rel="stylesheet" href="/css/jquery-ui.theme.min.css">
    
      <link rel="stylesheet" href="/css/highlight.css">
    
      <link rel="stylesheet" href="/css/my.css">
    

    
      
    

    

    <meta property="og:title" content="Windows" />
<meta property="og:description" content="Wallaroo supports windowing over aggregations. This allows you to break an infinite stream into manageable chunks and also allows you to see how your inputs evolve over time.
There are two broad categories of windows currently supported: count-based and range-based. Range-based windows can be further divided into tumbling and sliding varieties. We&rsquo;ll look at each of these in turn.
If you are not familiar with aggregations in Wallaroo, it might be helpful to read this section before proceeding." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://docs.wallaroolabs.com/core-concepts/windows/" />

<meta itemprop="name" content="Windows">
<meta itemprop="description" content="Wallaroo supports windowing over aggregations. This allows you to break an infinite stream into manageable chunks and also allows you to see how your inputs evolve over time.
There are two broad categories of windows currently supported: count-based and range-based. Range-based windows can be further divided into tumbling and sliding varieties. We&rsquo;ll look at each of these in turn.
If you are not familiar with aggregations in Wallaroo, it might be helpful to read this section before proceeding.">



<meta itemprop="wordCount" content="1217">



<meta itemprop="keywords" content="" />
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Windows"/>
<meta name="twitter:description" content="Wallaroo supports windowing over aggregations. This allows you to break an infinite stream into manageable chunks and also allows you to see how your inputs evolve over time.
There are two broad categories of windows currently supported: count-based and range-based. Range-based windows can be further divided into tumbling and sliding varieties. We&rsquo;ll look at each of these in turn.
If you are not familiar with aggregations in Wallaroo, it might be helpful to read this section before proceeding."/>


    <script src="//cdnjs.cloudflare.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js"></script>
  </head>

  <body class="ma0 avenir bg-near-white">

    

  <header>
    <div class="bg-green">
      <nav class="pv3 ph3 ph4-ns" role="navigation">
  <div class="flex-l justify-between items-center center">
    <a href="https://docs.wallaroolabs.com/" class="f3 fw2 hover-white no-underline white-90 dib">
      Wallaroo
    </a>
    <div class="flex-l items-center">
      
        <ul class="pl0 mr3">
          
          <li class="list f5 f4-ns fw4 dib pr3">
            <a class="hover-white no-underline white-90" href="/core-concepts/" title="Core Concepts page">
              Core Concepts
            </a>
          </li>
          
          <li class="list f5 f4-ns fw4 dib pr3">
            <a class="hover-white no-underline white-90" href="/python-installation/" title="Installation page">
              Installation
            </a>
          </li>
          
          <li class="list f5 f4-ns fw4 dib pr3">
            <a class="hover-white no-underline white-90" href="/python-tutorial/" title="Tutorial page">
              Tutorial
            </a>
          </li>
          
          <li class="list f5 f4-ns fw4 dib pr3">
            <a class="hover-white no-underline white-90" href="/operators-manual/" title="Operators Manual page">
              Operators Manual
            </a>
          </li>
          
        </ul>
      
      
<div hidden>
  <span id="new-window-0">Opens in a new window</span>
  <span id="new-window-1">Opens an external site</span>
  <span id="new-window-2">Opens an external site in a new window</span>
</div>









    </div>
  </div>
</nav>

    </div>
  </header>


    <main role="main">
      
  <article class="w-100 ph4 pb5 pb6-ns pt1 pt3-ns">
      <div class="order-0 w-20 dn db-l doc-menu" id="doc-menu">
        
<nav role="navigation">
  <ul class="list pa0 nl2">
    
      
      <li class="f5 w-100 hover-bg-light-gray hover-accent-color-light fw8">
        <a href="javascript:void(0)" class="js-toggle dib w-100 link mid-gray hover-accent-color-light pl2 pr2 pv2  primary-color" data-target=".core-concepts">Core Concepts</a>
        <ul class="core-concepts desktopmenu animated fadeIn list pl0 bg-light-gray db">
          <li class="f6 fw4">
            <a href="/core-concepts/" class="db link hover-bg-gray hover-white pl3 pr2 pv2 black ">
              Wallaroo Core Concepts
            </a>
          </li>
          <li class="f6 fw4">
            <a href="/core-concepts/state/" class="db link hover-bg-gray hover-white pl3 pr2 pv2 black ">
              State
            </a>
          </li>
          <li class="f6 fw4">
            <a href="/core-concepts/working-with-state/" class="db link hover-bg-gray hover-white pl3 pr2 pv2 black ">
              Working with State
            </a>
          </li>
          <li class="f6 fw4">
            <a href="/core-concepts/partitioning/" class="db link hover-bg-gray hover-white pl3 pr2 pv2 black ">
              Partitioning
            </a>
          </li>
          <li class="f6 fw4">
            <a href="/core-concepts/aggregations/" class="db link hover-bg-gray hover-white pl3 pr2 pv2 black ">
              Aggregations
            </a>
          </li>
          <li class="f6 fw4">
            <a href="/core-concepts/windows/" class="db link hover-bg-gray hover-white pl3 pr2 pv2 primary-color ">
              Windows
            </a>
          </li>
        </ul>
      </li>
      
      <li class="f5 w-100 hover-bg-light-gray hover-accent-color-light fw8">
        <a href="javascript:void(0)" class="js-toggle dib w-100 link mid-gray hover-accent-color-light pl2 pr2 pv2 " data-target=".pyinstallation">Python Installation Guide</a>
        <ul class="pyinstallation desktopmenu animated fadeIn list pl0 bg-light-gray dn">
          <li class="f6 fw4">
            <a href="/python-installation/" class="db link hover-bg-gray hover-white pl3 pr2 pv2 black ">
              Choosing an Installation Option
            </a>
          </li>
          <li class="f6 fw4">
            <a href="/python-installation/python-docker-installation-guide/" class="db link hover-bg-gray hover-white pl3 pr2 pv2 black ">
              Installing with Docker
            </a>
          </li>
          <li class="f6 fw4">
            <a href="/python-installation/python-vagrant-installation-guide/" class="db link hover-bg-gray hover-white pl3 pr2 pv2 black ">
              Installing with Vagrant
            </a>
          </li>
          <li class="f6 fw4">
            <a href="/python-installation/python-wallaroo-up-installation-guide/" class="db link hover-bg-gray hover-white pl3 pr2 pv2 black ">
              Installing with Wallaroo Up
            </a>
          </li>
        </ul>
      </li>
      
      <li class="f5 w-100 hover-bg-light-gray hover-accent-color-light fw8">
        <a href="javascript:void(0)" class="js-toggle dib w-100 link mid-gray hover-accent-color-light pl2 pr2 pv2 " data-target=".pytutorial">Python Tutorial</a>
        <ul class="pytutorial desktopmenu animated fadeIn list pl0 bg-light-gray dn">
          <li class="f6 fw4">
            <a href="/python-tutorial/" class="db link hover-bg-gray hover-white pl3 pr2 pv2 black ">
              Python API Introduction
            </a>
          </li>
          <li class="f6 fw4">
            <a href="/python-tutorial/running-a-wallaroo-application/" class="db link hover-bg-gray hover-white pl3 pr2 pv2 black ">
              Running A Wallaroo Application
            </a>
          </li>
          <li class="f6 fw4">
            <a href="/python-tutorial/writing-your-own-application/" class="db link hover-bg-gray hover-white pl3 pr2 pv2 black ">
              Writing Your Own Application
            </a>
          </li>
          <li class="f6 fw4">
            <a href="/python-tutorial/writing-your-own-stateful-application/" class="db link hover-bg-gray hover-white pl3 pr2 pv2 black ">
              Writing Your Own Stateful Application
            </a>
          </li>
          <li class="f6 fw4">
            <a href="/python-tutorial/word-count/" class="db link hover-bg-gray hover-white pl3 pr2 pv2 black ">
              Word Count
            </a>
          </li>
          <li class="f6 fw4">
            <a href="/python-tutorial/interworker-serialization-and-resilience/" class="db link hover-bg-gray hover-white pl3 pr2 pv2 black ">
              Inter-worker Serialization and Resilience
            </a>
          </li>
          <li class="f6 fw4">
            <a href="/python-tutorial/using-connectors/" class="db link hover-bg-gray hover-white pl3 pr2 pv2 black ">
              Using Connectors as Sources &amp; Sinks
            </a>
          </li>
          <li class="f6 fw4">
            <a href="/python-tutorial/api/" class="db link hover-bg-gray hover-white pl3 pr2 pv2 black ">
              Wallaroo Python API Classes
            </a>
          </li>
          <li class="f6 fw4">
            <a href="/python-tutorial/debugging/" class="db link hover-bg-gray hover-white pl3 pr2 pv2 black ">
              Debugging
            </a>
          </li>
          <li class="f6 fw4">
            <a href="/python-tutorial/tcp-decoders-and-encoders/" class="db link hover-bg-gray hover-white pl3 pr2 pv2 black ">
              TCP Decoders and Encoders
            </a>
          </li>
          <li class="f6 fw4">
            <a href="/python-tutorial/virtualenv/" class="db link hover-bg-gray hover-white pl3 pr2 pv2 black ">
              Wallaroo and Virtualenv
            </a>
          </li>
          <li class="f6 fw4">
            <a href="/python-tutorial/starting-a-new-shell/" class="db link hover-bg-gray hover-white pl3 pr2 pv2 black ">
              Starting a new shell
            </a>
          </li>
        </ul>
      </li>
      
      <li class="f5 w-100 hover-bg-light-gray hover-accent-color-light fw8">
        <a href="javascript:void(0)" class="js-toggle dib w-100 link mid-gray hover-accent-color-light pl2 pr2 pv2 " data-target=".operators-manual">Operators Manual</a>
        <ul class="operators-manual desktopmenu animated fadeIn list pl0 bg-light-gray dn">
          <li class="f6 fw4">
            <a href="/operators-manual/" class="db link hover-bg-gray hover-white pl3 pr2 pv2 black ">
              Operators Manual
            </a>
          </li>
          <li class="f6 fw4">
            <a href="/operators-manual/running-wallaroo/" class="db link hover-bg-gray hover-white pl3 pr2 pv2 black ">
              Running Wallaroo
            </a>
          </li>
          <li class="f6 fw4">
            <a href="/operators-manual/autoscale/" class="db link hover-bg-gray hover-white pl3 pr2 pv2 black ">
              Autoscale
            </a>
          </li>
          <li class="f6 fw4">
            <a href="/operators-manual/resilience-crash/" class="db link hover-bg-gray hover-white pl3 pr2 pv2 black ">
              Crash Resilience
            </a>
          </li>
          <li class="f6 fw4">
            <a href="/operators-manual/resilience-data-redundancy/" class="db link hover-bg-gray hover-white pl3 pr2 pv2 black ">
              Data Redundancy
            </a>
          </li>
          <li class="f6 fw4">
            <a href="/operators-manual/command-line-options/" class="db link hover-bg-gray hover-white pl3 pr2 pv2 black ">
              Command-Line Options
            </a>
          </li>
          <li class="f6 fw4">
            <a href="/operators-manual/metrics-ui/" class="db link hover-bg-gray hover-white pl3 pr2 pv2 black ">
              Wallaroo Metrics UI
            </a>
          </li>
        </ul>
      </li>
      
      <li class="f5 w-100 hover-bg-light-gray hover-accent-color-light fw8">
        <a href="javascript:void(0)" class="js-toggle dib w-100 link mid-gray hover-accent-color-light pl2 pr2 pv2 " data-target=".appendix">Appendix</a>
        <ul class="appendix desktopmenu animated fadeIn list pl0 bg-light-gray dn">
          <li class="f6 fw4">
            <a href="/appendix/giles-sender/" class="db link hover-bg-gray hover-white pl3 pr2 pv2 black ">
              Giles sender
            </a>
          </li>
          <li class="f6 fw4">
            <a href="/appendix/wallaroo-docker-tips/" class="db link hover-bg-gray hover-white pl3 pr2 pv2 black ">
              Tips for using Wallaroo in Docker
            </a>
          </li>
        </ul>
      </li>
  </ul>
</nav>

      </div>
    <div class="flex-l" id="the-body"><div class="order-2 w-100 w-20-l ph5-m ph0-l mb4 sticky dn db-l" id="context-menu"><div class="bg-light-gray pa3 nested-list-reset nested-copy-line-height nested-links">
    <p class="f5 b mb3">What's in this document</p>
      <nav id="TableOfContents">
<ul>
<li>
<ul>
<li><a href="#count-based-windows">Count-based Windows</a></li>
<li><a href="#range-based-windows">Range-based Windows</a>
<ul>
<li><a href="#tumbling-windows">Tumbling Windows</a></li>
<li><a href="#window-triggers">Window Triggers</a>
<ul>
<li><a href="#message-trigger">Message Trigger</a></li>
<li><a href="#timeout-trigger">Timeout Trigger</a></li>
</ul></li>
<li><a href="#sliding-windows">Sliding Windows</a></li>
</ul></li>
</ul></li>
</ul>
</nav>
  </div>




</div><div class="order-1 w-60-l mw9 ph0 ph5-ns mid-gray nested-copy-line-height no-underline nested-links nested-img nested-copy-seperator nested-blockquote mt0-ns" style="flex-grow:1;">
        <div class="order-0 mt4 w-100 center mw7" style="clear: both;">
          <a id="doc-menu-toggle" class="icon icon-menu" href="javascript:void(0)" onClick="hideShowDM()"></a><a id="context-menu-toggle" class="icon icon-menu" href="javascript:void(0)" onClick="hideShowCM()"></a></div>

        <div class="documentation-copy center mw7">
          <header class="mt4 w-100">
            <p class="f6 b helvetica tracked">
                
              
            </p>
            <h1 class="f1 athelas mb1">Windows</h1>
          </header>

          <main class="nested-copy-line-height lh-copy serif f4 nested-links nested-img mid-gray pr4-l">

<p>Wallaroo supports windowing over aggregations. This allows you to break an infinite stream into manageable chunks and also allows you to see how your inputs evolve over time.</p>

<p>There are two broad categories of windows currently supported: count-based and range-based. Range-based windows can be further divided into tumbling and sliding varieties. We&rsquo;ll look at each of these in turn.</p>

<p>If you are not familiar with aggregations in Wallaroo, it might be helpful to read <a href="/core-concepts/aggregations">this section</a> before proceeding.</p>

<h2 id="count-based-windows">Count-based Windows</h2>

<p>Count-based windows emit an output every <code>n</code> input messages, where <code>n</code> is specified via the API. For example (using the Python API):</p>

<pre><code class="language-python">    (inputs
        .to(wallaroo.count_windows(5)
            .over(MySumAgg))
        .to_sink(sink_config))
</code></pre>

<p>This performs the user-defined <code>MySumAgg</code> aggregation for every 5 inputs.</p>

<pre><code>Messages:
01 02 03 04 05 06 07 08 09 10 11 12 13 14 15 16 17 18 19 20 
|-------------|--------------|--------------|--------------|
    window 1      window 2       window 3       window 4
    sum = 15      sum = 40       sum = 65       sum = 90
</code></pre>

<h2 id="range-based-windows">Range-based Windows</h2>

<p>Range-based windows are defined based on specific time-based ranges. They fall into two categories, tumbling and sliding. We&rsquo;ll look at tumbling first.</p>

<h3 id="tumbling-windows">Tumbling Windows</h3>

<p>Tumbling range-based windows are non-overlapping fixed-size time-based windows.
For example, let&rsquo;s define windows with a range of 3 seconds:</p>

<pre><code class="language-python">    (inputs
        .to(wallaroo.range_windows(wallaroo.seconds(3))
            .over(MySumAgg))
        .to_sink(...))
</code></pre>

<p>Assuming we start from time 00:00, this would produce the following tumbling windows:</p>

<pre><code> Time (min:sec):
|00:00|00:01|00:02|00:03|00:04|00:05|00:06|00:07|00:08|00:09|00:10|00:11
|-----------------|-----------------|-----------------|-----------------|
     window 1          window 2          window 3          window 4
   [00:00,00:03)     [00:03,00:06)     [00:06,00:09)     [00:09,00:12)
</code></pre>

<p>Each window above is indicated by an interval such as <code>[00:00,00:03)</code>, indicating &ldquo;the window containing all times equal to or greater than <code>00:00</code> and less than <code>00:03</code>&rdquo;.</p>

<p>Incoming messages will be placed in a window based on the event time of the message. In the near future, you will be able to derive this event time from each input message that arrives at a Wallaroo source. For now, it is always the ingest time for the input message.</p>

<p>So if we had the following four messages (min:sec.ms):</p>

<pre><code>&lt;id: 1, event_time: 00:04.043&gt;
&lt;id: 2, event_time: 00:01.022&gt;
&lt;id: 3, event_time: 00:06.000&gt;
&lt;id: 4, event_time: 00:09.055&gt;
</code></pre>

<p>They would be placed as follows:</p>

<pre><code>&lt;id: 1, event_time: 00:04.043&gt; --&gt; window 2 [00:03,00:06)
&lt;id: 2, event_time: 00:01.022&gt; --&gt; window 1 [00:00,00:03)
&lt;id: 3, event_time: 00:06.000&gt; --&gt; window 3 [00:06,00:09)
&lt;id: 4, event_time: 00:05.655&gt; --&gt; window 2 [00:03,00:06)
</code></pre>

<p>Notice that it doesn&rsquo;t matter which order the messages arrive in. They will be placed in the correct windows based on event time.</p>

<p>However, if there were no limit to how late messages can be, then we would have to keep around the state for each window indefinitely. This can add up quickly in a high-volume scenario. As a result, we currently throw away window data once the window output is triggered (i.e. the aggregation <code>output()</code> method is called and an output is produced for the window). This means that from then on, late messages are dropped on the floor. In future versions of Wallaroo, we will provide more fine-grained policies so that you can choose other options for late messages. In the meantime, the one knob we provide is a <code>delay</code> on triggering a window. For example:</p>

<pre><code class="language-python">    (inputs
        .to(wallaroo.range_windows(wallaroo.seconds(3))
            .with_delay(wallaroo.seconds(3))
            .over(MySumAgg))
        .to_sink(sink_config))
</code></pre>

<p>This says that we delay triggering each window for 3 seconds. Think of the delay knob as setting either (1) an estimation of the maximum lateness for messages or (2) the lateness threshold beyond which you no longer care about messages. The knob is essentially trading off between latency (longer delays means longer waits for window outputs) and completeness (shorter delays potentially mean more ignored messages).</p>

<p>IMPORTANT NOTE: If your application requires a guarantee that no messages are ever ignored, then it&rsquo;s not currently safe to use the Wallaroo windowing API unless you are certain that no messages will ever be later than your delay setting. However, as mentioned above, we will be adding more fine-grained policy control for late message in future versions.</p>

<h3 id="window-triggers">Window Triggers</h3>

<p>We have talked about triggering window outputs but have not yet explained how this happens. There are two types of events that can potentially trigger a window output (corresponding to a call to the <code>output()</code> method on the underlying aggregation): (1) a message arrives at the window stage, and (2) a timeout is triggered. Each of these potentially triggers window outputs in different ways, so we&rsquo;ll look at them each in turn.</p>

<h4 id="message-trigger">Message Trigger</h4>

<p>When a message arrives at the window stage, we attempt to determine whether or not we have seen all messages for a given window, at which point we can trigger its output. We make this determination based on an event time watermark system internal to Wallaroo. As messages come into our system, we use their event timestamps to update these watermarks. We then propagate the latest watermarks downstream. A watermark is an estimate of how far we have progressed in event time up to a particular stage. It serves as a heuristic for determining whether we have seen all messages destined for a certain window. When using this heuristic in practice, we also take into account the user-defined <code>delay</code> parameter explained above.</p>

<p>If a window ends at time 00:10, and the user-defined delay is 00:02, then we will trigger that window&rsquo;s output once we have a watermark passing the 00:12 mark. We check our watermark against our windows every time we receive a message at a stage containing those windows.</p>

<h4 id="timeout-trigger">Timeout Trigger</h4>

<p>If we only triggered window outputs based on incoming messages, then we would be left with a potential straggler problem. Imagine that our window range is defined in seconds but our incoming stream stopped sending for hours at a time. The last group of messages might have been placed in windows, but we never received a message with a watermark high enough to trigger those windows. In this situation, the latency for those windows would end up being hours long, since we&rsquo;d have to wait for the stream to start up again to get a chance to trigger them.</p>

<p>This is where timeouts come in. We use timeouts to periodically check if we have not heard from our upstreams past a certain threshold. Currently, neither the timeouts nor the threshold are directly configurable by the user (though this will change in future releases). We set both the timeout and the threshold as a function of the window range plus the user-defined delay. If the threshold is passed, then we trigger the window outputs.</p>

<h3 id="sliding-windows">Sliding Windows</h3>

<p>Sliding range-based windows are overlapping fixed-size time-based windows.
For example, let&rsquo;s define windows with a range of 6 seconds and a slide of 3 seconds:</p>

<pre><code class="language-python">    (inputs
        .to(wallaroo.range_windows(wallaroo.seconds(6))
            .with_slide(wallaroo.seconds(3))
            .over(MySumAgg))
        .to_sink(...))
</code></pre>

<p>Assuming we start from time 00:00, this would produce the following sliding windows:</p>

<pre><code> Time (min:sec):
|00:00|00:01|00:02|00:03|00:04|00:05|00:06|00:07|00:08|00:09|00:10|00:11
|-----------------------------------|
   [00:00,00:06)                     
                  |-----------------------------------|
                     [00:03,00:09)                       
                                    |-----------------------------------|
                                        [00:06,00:12)     
                                                      |------------------
                                                          [00:09,00:15)     
</code></pre>

<p>Notice how these windows overlap. Messages will be assigned to more than one window at a time. Using our examples from above:</p>

<pre><code>&lt;id: 1, event_time: 00:04:043&gt;
&lt;id: 2, event_time: 00:01:022&gt;
&lt;id: 3, event_time: 00:06:000&gt;
&lt;id: 4, event_time: 00:09:055&gt;
</code></pre>

<p>These would be placed in our sliding windows as follows:</p>

<pre><code>&lt;id: 1, event_time: 00:04:043&gt; --&gt; [00:00,00:06) and [00:03,00:09)
&lt;id: 2, event_time: 00:01:022&gt; --&gt; [00:00,00:06)
&lt;id: 3, event_time: 00:06:000&gt; --&gt; [00:03,00:09) and [00:06,00:12)
&lt;id: 4, event_time: 00:05:655&gt; --&gt; [00:00,00:06) and [00:03,00:09)
</code></pre>

<p>Tumbling windows are actually a special case of sliding windows where the window range and slide are equal.</p>
</main>
        </div>
      </div>
    </div>
  </article>

    </main>
    

<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.8.0/highlight.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.10.0/languages/pony.min.js"></script>
<script>hljs.initHighlightingOnLoad();</script>

<script async defer src="https://buttons.github.io/buttons.js"></script>

<script>
  var toggleBtns = document.getElementsByClassName('js-toggle')
  for (var i = 0; i < toggleBtns.length; i++) {
    toggleBtns[i].addEventListener('click', toggleClass, false)
  }

  var myToggleBtns = document.getElementsByClassName('hide-show-toggle')
  for (var i = 0; i < myToggleBtns.length; i++) {
    myToggleBtns[i].addEventListener('click', hideShow, false)
  }

function hideShowDM() {
  var menu = document.getElementById("doc-menu")
  var thebody = document.getElementById("the-body")
  if (window.getComputedStyle(menu).display == "none") {
    menu.style.display = "block";
    thebody.style.left = "300px";
  } else {
    menu.style.display = "none";
    thebody.style.left = "0px";
  }
}

function hideShowCM() {
  var menu = document.getElementById("context-menu")
  if (window.getComputedStyle(menu).display == "none") {
    menu.style.display = "block";
  } else {
    menu.style.display = "none";
  }
}

function toggleClass() {
  
  var content = this.dataset.target.split(' ')
  
  var mobileCurrentlyOpen = document.querySelector('.mobilemenu:not(.dn)')
  var desktopCurrentlyOpen = document.querySelector('.desktopmenu:not(.dn)')
  var desktopActive = document.querySelector('.desktopmenu:not(.dn)')

  
  for (var i = 0; i < content.length; i++) {
    var matches = document.querySelectorAll(content[i]);
    
    [].forEach.call(matches, function(dom) {
        dom.classList.contains('dn') ?
        dom.classList.remove('dn') :
        dom.classList.add('dn');
         return false;
       });
        
      if (mobileCurrentlyOpen) mobileCurrentlyOpen.classList.add('dn')
      if (desktopCurrentlyOpen) desktopCurrentlyOpen.classList.add('dn')
      if (desktopActive) desktopActive.classList.remove('db')

    }
  }

  let codeBlocks = document.getElementsByTagName('code')
  for (let [key, codeBlock] of Object.entries(codeBlocks)){
  var widthDif = codeBlock.scrollWidth - codeBlock.clientWidth
  if (widthDif > 0)
    codeBlock.parentNode.classList.add('expand')
  }
</script>

  </body>
</html>
