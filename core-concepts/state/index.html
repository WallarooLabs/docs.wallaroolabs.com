<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    
    <title>Wallaroo  | State</title>
    <meta name="HandheldFriendly" content="True">
    <meta name="MobileOptimized" content="320">

    <meta name="viewport" content="width=device-width,minimum-scale=1">
    <meta name="generator" content="Hugo 0.52" />
    
    
      <META NAME="ROBOTS" CONTENT="NOINDEX, NOFOLLOW">
    

    <style>
      @font-face {
        font-family: 'Icon';
        src: url('/dist/fonts/icon.eot?52m981');
        src: url('/dist/fonts/icon.eot?#iefix52m981')
               format('embedded-opentype'),
             url('/dist/fonts/icon.woff?52m981')
               format('woff'),
             url('/dist/fonts/icon.ttf?52m981')
               format('truetype'),
             url('/dist/fonts/icon.svg?52m981#icon')
               format('svg');
        font-weight: normal;
        font-style: normal;
      }
    </style>

    <link href="/dist/css/app.css" rel="stylesheet">
    <link href="/dist/css/highlight.css" rel="stylesheet">
    <link href="/dist/css/icon.css" rel="stylesheet">
    <link href="/dist/css/wallaroo.css" rel="stylesheet">

    
      <link rel="stylesheet" href="/css/jquery-ui.min.css">
    
      <link rel="stylesheet" href="/css/jquery-ui.theme.min.css">
    
      <link rel="stylesheet" href="/css/highlight.css">
    
      <link rel="stylesheet" href="/css/my.css">
    

    
      
    

    

    <meta property="og:title" content="State" />
<meta property="og:description" content="The expectation with Wallaroo is that most applications will be stateful. Understanding how Wallaroo handles state is key to being able to design effective Wallaroo applications. In this section, we&rsquo;re going to take you through how state works in Wallaroo and what advantages this brings.
Transactions in Wallaroo Transactions are awesome. Using a data management system that features transactions makes our lives as programmers much easier. Transactions provide certain guarantees about how data will be updated that make it easier to reason about our code, easier to understand what our code will do." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://docs.wallaroolabs.com/core-concepts/state/" />

<meta itemprop="name" content="State">
<meta itemprop="description" content="The expectation with Wallaroo is that most applications will be stateful. Understanding how Wallaroo handles state is key to being able to design effective Wallaroo applications. In this section, we&rsquo;re going to take you through how state works in Wallaroo and what advantages this brings.
Transactions in Wallaroo Transactions are awesome. Using a data management system that features transactions makes our lives as programmers much easier. Transactions provide certain guarantees about how data will be updated that make it easier to reason about our code, easier to understand what our code will do.">



<meta itemprop="wordCount" content="728">



<meta itemprop="keywords" content="" />
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="State"/>
<meta name="twitter:description" content="The expectation with Wallaroo is that most applications will be stateful. Understanding how Wallaroo handles state is key to being able to design effective Wallaroo applications. In this section, we&rsquo;re going to take you through how state works in Wallaroo and what advantages this brings.
Transactions in Wallaroo Transactions are awesome. Using a data management system that features transactions makes our lives as programmers much easier. Transactions provide certain guarantees about how data will be updated that make it easier to reason about our code, easier to understand what our code will do."/>


    <script src="//cdnjs.cloudflare.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js"></script>
  </head>

  <body class="ma0 avenir bg-near-white">

    

  <header>
    <div class="bg-green">
      <nav class="pv3 ph3 ph4-ns" role="navigation">
  <div class="flex-l justify-between items-center center">
    <a href="https://docs.wallaroolabs.com/" class="f3 fw2 hover-white no-underline white-90 dib">
      Wallaroo
    </a>
    <div class="flex-l items-center">
      
        <ul class="pl0 mr3">
          
          <li class="list f5 f4-ns fw4 dib pr3">
            <a class="hover-white no-underline white-90" href="/core-concepts/" title="Core Concepts page">
              Core Concepts
            </a>
          </li>
          
          <li class="list f5 f4-ns fw4 dib pr3">
            <a class="hover-white no-underline white-90" href="/pony-installation/" title="Installation page">
              Installation
            </a>
          </li>
          
          <li class="list f5 f4-ns fw4 dib pr3">
            <a class="hover-white no-underline white-90" href="/pony-tutorial/" title="Tutorial page">
              Tutorial
            </a>
          </li>
          
          <li class="list f5 f4-ns fw4 dib pr3">
            <a class="hover-white no-underline white-90" href="/operators-manual/" title="Operators Manual page">
              Operators Manual
            </a>
          </li>
          
        </ul>
      
      
<div hidden>
  <span id="new-window-0">Opens in a new window</span>
  <span id="new-window-1">Opens an external site</span>
  <span id="new-window-2">Opens an external site in a new window</span>
</div>









    </div>
  </div>
</nav>

    </div>
  </header>


    <main role="main">
      
  <article class="w-100 ph4 pb5 pb6-ns pt1 pt3-ns">
      <div class="order-0 w-20 dn db-l doc-menu" id="doc-menu">
        
<nav role="navigation">
  <ul class="list pa0 nl2">
    
      
      <li class="f5 w-100 hover-bg-light-gray hover-accent-color-light fw8">
        <a href="javascript:void(0)" class="js-toggle dib w-100 link mid-gray hover-accent-color-light pl2 pr2 pv2  primary-color" data-target=".core-concepts">Core Concepts</a>
        <ul class="core-concepts desktopmenu animated fadeIn list pl0 bg-light-gray db">
          <li class="f6 fw4">
            <a href="/core-concepts/" class="db link hover-bg-gray hover-white pl3 pr2 pv2 black ">
              Wallaroo Core Concepts
            </a>
          </li>
          <li class="f6 fw4">
            <a href="/core-concepts/state/" class="db link hover-bg-gray hover-white pl3 pr2 pv2 primary-color ">
              State
            </a>
          </li>
          <li class="f6 fw4">
            <a href="/core-concepts/working-with-state/" class="db link hover-bg-gray hover-white pl3 pr2 pv2 black ">
              Working with State
            </a>
          </li>
          <li class="f6 fw4">
            <a href="/core-concepts/partitioning/" class="db link hover-bg-gray hover-white pl3 pr2 pv2 black ">
              Partitioning
            </a>
          </li>
          <li class="f6 fw4">
            <a href="/core-concepts/aggregations/" class="db link hover-bg-gray hover-white pl3 pr2 pv2 black ">
              Aggregations
            </a>
          </li>
          <li class="f6 fw4">
            <a href="/core-concepts/windows/" class="db link hover-bg-gray hover-white pl3 pr2 pv2 black ">
              Windows
            </a>
          </li>
        </ul>
      </li>
      
      <li class="f5 w-100 hover-bg-light-gray hover-accent-color-light fw8">
        <a href="javascript:void(0)" class="js-toggle dib w-100 link mid-gray hover-accent-color-light pl2 pr2 pv2 " data-target=".ponyinstallation">Installation Guide</a>
        <ul class="ponyinstallation desktopmenu animated fadeIn list pl0 bg-light-gray dn">
          <li class="f6 fw4">
            <a href="/pony-installation/" class="db link hover-bg-gray hover-white pl3 pr2 pv2 black ">
              Installing with Wallaroo Up
            </a>
          </li>
        </ul>
      </li>
      
      <li class="f5 w-100 hover-bg-light-gray hover-accent-color-light fw8">
        <a href="javascript:void(0)" class="js-toggle dib w-100 link mid-gray hover-accent-color-light pl2 pr2 pv2 " data-target=".ponytutorial">Pony Tutorial</a>
        <ul class="ponytutorial desktopmenu animated fadeIn list pl0 bg-light-gray dn">
          <li class="f6 fw4">
            <a href="/pony-tutorial/" class="db link hover-bg-gray hover-white pl3 pr2 pv2 black ">
              Pony API Introduction
            </a>
          </li>
          <li class="f6 fw4">
            <a href="/pony-tutorial/running-a-wallaroo-application/" class="db link hover-bg-gray hover-white pl3 pr2 pv2 black ">
              Running A Wallaroo Application
            </a>
          </li>
          <li class="f6 fw4">
            <a href="/pony-tutorial/writing-your-own-application/" class="db link hover-bg-gray hover-white pl3 pr2 pv2 black ">
              Writing Your Own Application
            </a>
          </li>
          <li class="f6 fw4">
            <a href="/pony-tutorial/writing-your-own-stateful-application/" class="db link hover-bg-gray hover-white pl3 pr2 pv2 black ">
              Writing Your Own Stateful Application
            </a>
          </li>
          <li class="f6 fw4">
            <a href="/pony-tutorial/word-count/" class="db link hover-bg-gray hover-white pl3 pr2 pv2 black ">
              Word Count
            </a>
          </li>
          <li class="f6 fw4">
            <a href="/pony-tutorial/api/" class="db link hover-bg-gray hover-white pl3 pr2 pv2 black ">
              Wallaroo Pony API Classes
            </a>
          </li>
          <li class="f6 fw4">
            <a href="/pony-tutorial/tcp-decoders-and-encoders/" class="db link hover-bg-gray hover-white pl3 pr2 pv2 black ">
              TCP Decoders and Encoders
            </a>
          </li>
          <li class="f6 fw4">
            <a href="/pony-tutorial/starting-a-new-shell/" class="db link hover-bg-gray hover-white pl3 pr2 pv2 black ">
              Starting a new shell
            </a>
          </li>
        </ul>
      </li>
      
      <li class="f5 w-100 hover-bg-light-gray hover-accent-color-light fw8">
        <a href="javascript:void(0)" class="js-toggle dib w-100 link mid-gray hover-accent-color-light pl2 pr2 pv2 " data-target=".operators-manual">Operators Manual</a>
        <ul class="operators-manual desktopmenu animated fadeIn list pl0 bg-light-gray dn">
          <li class="f6 fw4">
            <a href="/operators-manual/" class="db link hover-bg-gray hover-white pl3 pr2 pv2 black ">
              Operators Manual
            </a>
          </li>
          <li class="f6 fw4">
            <a href="/operators-manual/running-wallaroo/" class="db link hover-bg-gray hover-white pl3 pr2 pv2 black ">
              Running Wallaroo
            </a>
          </li>
          <li class="f6 fw4">
            <a href="/operators-manual/autoscale/" class="db link hover-bg-gray hover-white pl3 pr2 pv2 black ">
              Autoscale
            </a>
          </li>
          <li class="f6 fw4">
            <a href="/operators-manual/resilience-crash/" class="db link hover-bg-gray hover-white pl3 pr2 pv2 black ">
              Crash Resilience
            </a>
          </li>
          <li class="f6 fw4">
            <a href="/operators-manual/resilience-data-redundancy/" class="db link hover-bg-gray hover-white pl3 pr2 pv2 black ">
              Data Redundancy
            </a>
          </li>
          <li class="f6 fw4">
            <a href="/operators-manual/command-line-options/" class="db link hover-bg-gray hover-white pl3 pr2 pv2 black ">
              Command-Line Options
            </a>
          </li>
          <li class="f6 fw4">
            <a href="/operators-manual/metrics-ui/" class="db link hover-bg-gray hover-white pl3 pr2 pv2 black ">
              Wallaroo Metrics UI
            </a>
          </li>
        </ul>
      </li>
      
      <li class="f5 w-100 hover-bg-light-gray hover-accent-color-light fw8">
        <a href="javascript:void(0)" class="js-toggle dib w-100 link mid-gray hover-accent-color-light pl2 pr2 pv2 " data-target=".appendix">Appendix</a>
        <ul class="appendix desktopmenu animated fadeIn list pl0 bg-light-gray dn">
          <li class="f6 fw4">
            <a href="/appendix/giles-sender/" class="db link hover-bg-gray hover-white pl3 pr2 pv2 black ">
              Giles sender
            </a>
          </li>
          <li class="f6 fw4">
            <a href="/appendix/wallaroo-docker-tips/" class="db link hover-bg-gray hover-white pl3 pr2 pv2 black ">
              Tips for using Wallaroo in Docker
            </a>
          </li>
        </ul>
      </li>
  </ul>
</nav>

      </div>
    <div class="flex-l" id="the-body"><div class="order-2 w-100 w-20-l ph5-m ph0-l mb4 sticky dn db-l" id="context-menu"><div class="bg-light-gray pa3 nested-list-reset nested-copy-line-height nested-links">
    <p class="f5 b mb3">What's in this document</p>
      <nav id="TableOfContents">
<ul>
<li>
<ul>
<li><a href="#transactions-in-wallaroo">Transactions in Wallaroo</a></li>
<li><a href="#wallaroo-and-state">Wallaroo and State</a></li>
<li><a href="#wallaroo-state-and-parallelization">Wallaroo, state, and parallelization</a></li>
<li><a href="#conclusion">Conclusion</a></li>
</ul></li>
</ul>
</nav>
  </div>




</div><div class="order-1 w-60-l mw9 ph0 ph5-ns mid-gray nested-copy-line-height no-underline nested-links nested-img nested-copy-seperator nested-blockquote mt0-ns" style="flex-grow:1;">
        <div class="order-0 mt4 w-100 center mw7" style="clear: both;">
          <a id="doc-menu-toggle" class="icon icon-menu" href="javascript:void(0)" onClick="hideShowDM()"></a><a id="context-menu-toggle" class="icon icon-menu" href="javascript:void(0)" onClick="hideShowCM()"></a></div>

        <div class="documentation-copy center mw7">
          <header class="mt4 w-100">
            <p class="f6 b helvetica tracked">
                
              
            </p>
            <h1 class="f1 athelas mb1">State</h1>
          </header>

          <main class="nested-copy-line-height lh-copy serif f4 nested-links nested-img mid-gray pr4-l">

<p>The expectation with Wallaroo is that most applications will be stateful. Understanding how Wallaroo handles state is key to being able to design effective Wallaroo applications. In this section, we&rsquo;re going to take you through how state works in Wallaroo and what advantages this brings.</p>

<h2 id="transactions-in-wallaroo">Transactions in Wallaroo</h2>

<p>Transactions are awesome. Using a data management system that features transactions makes our lives as programmers much easier. Transactions provide certain guarantees about how data will be updated that make it easier to reason about our code, easier to understand what our code will do. This is particularly true when we are talking about concurrent operations.</p>

<p>It&rsquo;s often quite easy to understand what our code is doing if we only have a single thread. Everything will happen in a nice linear, serial fashion. Sadly, the world in which our code runs isn&rsquo;t serial, it&rsquo;s concurrent. Many different operations happening at one time. Transactions, in part, allow us to think about how our code is updating data as though the updates were happening one at a time, that is in a serial fashion.</p>

<p>Wallaroo doesn&rsquo;t have transactions in the traditional database sense. However, we do have a means of providing similar guarantees. Wallaroo allows you to atomically update individual bits of state. To understand how that works and the guarantees that Wallaroo provides, let&rsquo;s dig into how Wallaroo handles that.</p>

<h2 id="wallaroo-and-state">Wallaroo and State</h2>

<p>The simplest thing we could do to make it easy to reason about state is to lock all the state in your application. Only allowing a single update or read at a time. It would make Wallaroo applications very easy to reason about. It would also make them incredibly slow.</p>

<p>What we&rsquo;ve done instead is to allow you to break your state down into more discrete entities we call &ldquo;state objects&rdquo;. All reads/writes of a given state object are guaranteed to happen in a serial fashion. No more than one thread will ever access a given state object at a time.</p>

<p>This makes it easy to reason about state within Wallaroo. All the wonderful reasoning benefits we get from transactions apply in Wallaroo, except that rather than being across an entire database, it&rsquo;s across individual state objects.</p>

<p>So what is a state object? Let&rsquo;s explain via an example. Imagine we are writing an application that keeps track of the latest price for different stock in the stock market. Each of the stocks would become a state object. It&rsquo;s the discrete unit of atomicity that we want to be able to safely update. We want to make sure only one thread at a time is updating IBM, but, we also want to go fast, so it&rsquo;s ok if APPL or AMZN is being updated at the same time.</p>

<p>Wallaroo allows you to define your own state objects that match your domain. For example, our example application might define a state object as:</p>

<pre><code>class Stock is State
  var last_price_seen: F64 = 0.0
  var highest_price_seen: F64 = 0.0
</code></pre>

<p>State objects can be arbitrarily complex. Our example is two fields. If your application required it, you could build a deeply nested series of objects.</p>

<h2 id="wallaroo-state-and-parallelization">Wallaroo, state, and parallelization</h2>

<p>In our stock market example, we can read from and write to each state object independently. Our state objects are a unit of parallelization. If we have 3,000 different state objects and 3,000 CPUs then we can update all our state objects concurrently. Odds are, we are going to have more state objects than we have CPUs. Wallaroo handles all parallelization and routing of messages to state objects.</p>

<p>The Wallaroo API features a concept called a &ldquo;key extractor function&rdquo; that allows you to examine a message and return a key that will be used for partitioning state. For example, imagine a message in our stock market application is:</p>

<pre><code class="language-json">{
&quot;symbol&quot;: &quot;IBM&quot;,
&quot;price&quot;: &quot;169.53&quot;
}
</code></pre>

<p>Our key extractor function would take a message as input and could return <code>IBM</code> as output. This would, in turn, be used by Wallaroo to route the message to the correct partition.</p>

<h2 id="conclusion">Conclusion</h2>

<p>Wallaroo gives you serialized access to state. By properly partitioning your state along transactional boundaries, you can parallelize access to independent pieces of state. Wallaroo takes care of this parallelization for you, all you have to do is give it a function that can tell it which pieces of state should be accessed for a particular message.</p>
</main>
        </div>
      </div>
    </div>
  </article>

    </main>
    

<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.8.0/highlight.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.10.0/languages/pony.min.js"></script>
<script>hljs.initHighlightingOnLoad();</script>

<script async defer src="https://buttons.github.io/buttons.js"></script>

<script>
  var toggleBtns = document.getElementsByClassName('js-toggle')
  for (var i = 0; i < toggleBtns.length; i++) {
    toggleBtns[i].addEventListener('click', toggleClass, false)
  }

  var myToggleBtns = document.getElementsByClassName('hide-show-toggle')
  for (var i = 0; i < myToggleBtns.length; i++) {
    myToggleBtns[i].addEventListener('click', hideShow, false)
  }

function hideShowDM() {
  var menu = document.getElementById("doc-menu")
  var thebody = document.getElementById("the-body")
  if (window.getComputedStyle(menu).display == "none") {
    menu.style.display = "block";
    thebody.style.left = "300px";
  } else {
    menu.style.display = "none";
    thebody.style.left = "0px";
  }
}

function hideShowCM() {
  var menu = document.getElementById("context-menu")
  if (window.getComputedStyle(menu).display == "none") {
    menu.style.display = "block";
  } else {
    menu.style.display = "none";
  }
}

function toggleClass() {
  
  var content = this.dataset.target.split(' ')
  
  var mobileCurrentlyOpen = document.querySelector('.mobilemenu:not(.dn)')
  var desktopCurrentlyOpen = document.querySelector('.desktopmenu:not(.dn)')
  var desktopActive = document.querySelector('.desktopmenu:not(.dn)')

  
  for (var i = 0; i < content.length; i++) {
    var matches = document.querySelectorAll(content[i]);
    
    [].forEach.call(matches, function(dom) {
        dom.classList.contains('dn') ?
        dom.classList.remove('dn') :
        dom.classList.add('dn');
         return false;
       });
        
      if (mobileCurrentlyOpen) mobileCurrentlyOpen.classList.add('dn')
      if (desktopCurrentlyOpen) desktopCurrentlyOpen.classList.add('dn')
      if (desktopActive) desktopActive.classList.remove('db')

    }
  }

  let codeBlocks = document.getElementsByTagName('code')
  for (let [key, codeBlock] of Object.entries(codeBlocks)){
  var widthDif = codeBlock.scrollWidth - codeBlock.clientWidth
  if (widthDif > 0)
    codeBlock.parentNode.classList.add('expand')
  }
</script>

  </body>
</html>
